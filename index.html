<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Mini App tổng quan chi tiêu</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
 <style>
  /* Nhóm: Các biến toàn cục */
  :root {
    --primary-color: #007AFF; /* Màu chính */
    --secondary-color: #6B7280; /* Màu phụ */
    --background-color: #F7F9FC; /* Màu nền */
    --card-bg: #FFFFFF; /* Màu nền thẻ */
    --text-color: #1F2A44; /* Màu chữ */
    --gradient-start: #007AFF; /* Màu gradient bắt đầu */
    --gradient-end: #00C4FF; /* Màu gradient kết thúc */
    --accent-color: #10B981; /* Màu nhấn */
  }

  /* Nhóm: Cấu hình chung cho trang */
  html { 
    font-size: 16px; /* Kích thước chữ cơ bản */
    overflow-x: hidden; /* Ngăn tràn ngang */
  }

  body {
    font-family: 'Inter', sans-serif; /* Font chữ chính */
    margin: 0; /* Không có lề */
    padding: 80px 20px 20px; /* Khoảng cách trên/dưới/trái/phải */
    background-color: var(--background-color); /* Màu nền */
    box-sizing: border-box; /* Bao gồm padding trong kích thước */
    width: 100%; /* Chiều rộng đầy đủ */
    min-width: 320px; /* Chiều rộng tối thiểu */
    overflow-x: hidden; /* Ngăn tràn ngang */
    height: 100vh; /* Chiều cao đầy đủ viewport */
    font-size: 1rem; /* Kích thước chữ mặc định */
    color: var(--text-color); /* Màu chữ */
  }

  .content-wrapper { 
    max-width: 700px; /* Chiều rộng tối đa nội dung */
    width: 100%; /* Chiều rộng đầy đủ */
    margin: 0 auto; /* Căn giữa */
    overflow-x: hidden; /* Ngăn tràn ngang */
  }

  .tab-content { 
    display: none; /* Ẩn nội dung tab mặc định */
    width: 100%; /* Chiều rộng đầy đủ */
  }

  .tab-content.active { 
    display: block; /* Hiển thị tab đang hoạt động */
  }

  /* Nhóm: Thanh điều hướng trên cùng (dùng chung cho tất cả tab) */
  .top-nav {
    position: fixed; /* Cố định ở trên cùng */
    top: 0; left: 0; right: 0; /* Đầy đủ chiều ngang */
    display: flex; /* Sắp xếp các mục theo hàng ngang */
    justify-content: space-around; /* Khoảng cách đều */
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)); /* Gradient nền */
    padding: 15px 0; /* Khoảng cách trên/dưới */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Đổ bóng */
    z-index: 1000; /* Độ ưu tiên hiển thị */
    height: 60px; /* Chiều cao cố định */
    width: 100%; /* Chiều rộng đầy đủ */
    max-width: 100%; /* Không vượt quá màn hình */
    margin: 0; /* Không có lề */
    overflow-x: hidden; /* Ngăn tràn ngang */
  }

  .nav-item {
    flex: 1; /* Chia đều không gian */
    text-align: center; /* Căn giữa chữ */
    cursor: pointer; /* Con trỏ chuột */
    padding: 5px; /* Khoảng cách bên trong */
    color: #fff; /* Màu chữ trắng */
    transition: opacity 0.3s, background-color 0.3s; /* Hiệu ứng chuyển đổi */
    font-size: 1rem; /* Kích thước chữ */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    justify-content: center; /* Căn giữa dọc */
    align-items: center; /* Căn giữa ngang */
  }

  .nav-item:hover { opacity: 0.8; } /* Hiệu ứng hover */
  .nav-item i { font-size: 1.5rem; margin-bottom: 5px; } /* Icon kích thước và khoảng cách */
  .nav-item span { display: block; font-size: 0.9rem; } /* Chữ bên dưới icon */
  .nav-item.active {
    font-weight: 600; /* Đậm khi active */
    color: #FFFFFF; /* Màu trắng */
    position: relative; /* Để thêm đường gạch dưới */
    border-bottom: none; /* Không có viền dưới */
  }
  .nav-item.active::after {
    content: ''; /* Đường gạch dưới */
    position: absolute;
    bottom: -2px; left: 50%; transform: translateX(-50%);
    width: 70px; height: 2px;
    background-color: #FFFFFF; /* Màu đường gạch */
  }

  /* Nhóm: Các thành phần giao diện chung */
  h1 { 
    font-size: 2rem; /* Kích thước tiêu đề lớn */
    margin-bottom: 2rem; /* Khoảng cách dưới */
    text-align: center; /* Căn giữa */
    font-weight: 700; /* Đậm */
  }

  h2 { 
    font-size: 1.5rem; /* Kích thước tiêu đề nhỏ hơn */
    margin-bottom: 1.5rem; /* Khoảng cách dưới */
    font-weight: 500; /* Độ đậm trung bình */
  }

  .input-group {
    margin-bottom: 1.5rem; /* Khoảng cách dưới */
    display: flex; /* Sắp xếp ngang */
    justify-content: center; /* Căn giữa */
    align-items: center; /* Căn giữa dọc */
    gap: 1rem; /* Khoảng cách giữa các phần tử */
    width: 100%; /* Chiều rộng đầy đủ */
    padding: 0 15px; /* Khoảng cách trái/phải */
    flex-wrap: nowrap; /* Không xuống dòng */
  }

  select, input[type="date"] {
    padding: 0.6rem; /* Khoảng cách bên trong */
    font-size: 1rem; /* Kích thước chữ */
    width: 140px; /* Chiều rộng cố định */
    border-radius: 12px; /* Bo góc */
    border: 1px solid #E5E7EB; /* Viền */
    background-color: var(--card-bg); /* Màu nền */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Đổ bóng nhẹ */
    transition: border-color 0.3s; /* Hiệu ứng viền */
  }

  select:focus, input[type="date"]:focus {
    outline: none; /* Bỏ viền mặc định khi focus */
    border-color: var(--primary-color); /* Màu viền khi focus */
  }

  button {
    padding: 0.6rem 1.5rem; /* Khoảng cách bên trong */
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)); /* Gradient nền */
    color: white; /* Màu chữ */
    border: none; /* Không viền */
    cursor: pointer; /* Con trỏ chuột */
    font-size: 1rem; /* Kích thước chữ */
    border-radius: 12px; /* Bo góc */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Đổ bóng */
    transition: transform 0.2s; /* Hiệu ứng di chuyển */
  }

  button:hover { 
    transform: translateY(-2px); /* Nâng lên khi hover */
  }

  .notification {
    text-align: center; /* Căn giữa */
    margin-bottom: 1rem; /* Khoảng cách dưới */
    font-size: 1rem; /* Kích thước chữ */
    color: var(--secondary-color); /* Màu chữ */
  }

  /* Nhóm: Thành phần dùng chung cho Tab 1, Tab 2, Tab 4 */
  .stats-container {
    display: flex; /* Sắp xếp các phần tử */
    flex-direction: column; /* Hiển thị dọc (đã sửa theo yêu cầu) */
    align-items: center; /* Căn giữa (đã sửa theo yêu cầu) */
    gap: 1rem; /* Khoảng cách giữa các phần tử */
    margin-bottom: 2rem; /* Khoảng cách dưới */
    width: 100%; /* Chiều rộng đầy đủ */
  }

  .stats-container > div { /* Thông báo không có dữ liệu */
    text-align: center; /* Căn giữa (đã sửa theo yêu cầu) */
  }

  .stat-box {
    padding: 1rem; /* Khoảng cách bên trong */
    width: 120px; /* Chiều rộng cố định */
    border-radius: 16px; /* Bo góc */
    font-size: 0.9rem; /* Kích thước chữ */
    flex-grow: 0; /* Không mở rộng */
    flex-shrink: 0; /* Không thu nhỏ */
    max-width: 120px; /* Chiều rộng tối đa */
    min-height: 80px; /* Chiều cao tối thiểu */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    align-items: center; /* Căn giữa ngang */
    justify-content: center; /* Căn giữa dọc */
    background: linear-gradient(135deg, #F8FAFC, #E5E7EB); /* Gradient nền */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* Đổ bóng */
    transition: transform 0.2s; /* Hiệu ứng di chuyển */
    text-align: center; /* Căn giữa chữ */
  }

  .stat-box:hover { 
    transform: translateY(-5px); /* Nâng lên khi hover */
  }

  .stat-box .title {
    font-weight: 500; /* Độ đậm trung bình */
    margin-bottom: 0.5rem; /* Khoảng cách dưới */
    color: var(--text-color); /* Màu chữ */
    font-size: 0.9rem; /* Kích thước chữ */
    white-space: normal; /* Cho phép xuống dòng */
    line-height: 1.2; /* Khoảng cách dòng */
  }

  .stat-box .amount {
    font-weight: 700; /* Đậm */
    font-size: 1.2rem; /* Kích thước chữ */
    display: flex; /* Sắp xếp nội dung */
    align-items: center; /* Căn giữa dọc */
    gap: 8px; /* Khoảng cách giữa các phần tử */
    white-space: nowrap; /* Không xuống dòng */
  }

  .income .amount { color: #10B981; } /* Màu cho thu nhập */
  .expense .amount { color: #EF4444; } /* Màu cho chi tiêu */
  .balance .amount { color: var(--primary-color); } /* Màu cho số dư */

  /* Nhóm: Tab 1 - Thống kê */
  .chart-container {
    margin-top: 0; /* Không có lề trên */
    width: 100%; /* Chiều rộng đầy đủ */
    max-width: 100%; /* Không vượt quá */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    align-items: center; /* Căn giữa */
    gap: 2rem; /* Khoảng cách giữa các phần tử */
    text-align: center; /* Căn giữa chữ */
  }

  .chart-container h2 { 
    width: 100%; /* Chiều rộng đầy Dit nhau đầy đủ /* Căn giữa tiêu đề */
    text-align: center; /* Căn giữa chữ */
    margin: 0 auto; /* Căn giữa ngang */
  }

  canvas#myChart {
    width: 100% !important; /* Chiều rộng đầy đủ */
    height: auto !important; /* Chiều cao tự động */
    max-width: 500px !important; /* Chiều rộng tối đa */
    aspect-ratio: 1 / 1; /* Tỷ lệ khung hình */
    display: block; /* Hiển thị dạng khối */
    margin: 0 auto; /* Căn giữa */
    background: var(--card-bg); /* Màu nền */
    border-radius: 16px; /* Bo góc */
    padding: 10px; /* Khoảng cách bên trong */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* Đổ bóng */
  }

  .custom-legend {
    width: 100%; /* Chiều rộng đầy đủ */
    max-width: 600px; /* Chiều rộng tối đa */
    display: flex; /* Sắp xếp ngang */
    justify-content: space-between; /* Khoảng cách đều */
    font-size: 1rem; /* Kích thước chữ */
    padding: 0; /* Không có lề */
    margin: 2rem auto 0; /* Khoảng cách trên và căn giữa */
    gap: 0.3rem; /* Khoảng cách giữa các cột */
  }

  .custom-legend-column {
    width: 48%; /* Chiều rộng mỗi cột */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    align-items: flex-start; /* Căn trái */
    min-width: 280px; /* Chiều rộng tối thiểu */
  }

  .legend-item {
    display: flex; /* Sắp xếp ngang */
    align-items: flex-start; /* Căn đầu dòng */
    margin-bottom: 0.8rem; /* Khoảng cách dưới */
  }

  .legend-color {
    width: 16px; height: 16px; /* Kích thước ô màu */
    margin-right: 0.75rem; /* Khoảng cách phải */
    display: inline-block; /* Hiển thị inline */
    flex-shrink: 0; /* Không thu nhỏ */
    border-radius: 4px; /* Bo góc */
    margin-top: 2px; /* Khoảng cách trên */
  }

  .legend-text { 
    font-size: 1rem; /* Kích thước chữ */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
  }

  .legend-value { 
    font-weight: 700; /* Đậm */
    margin-top: 0.2rem; /* Khoảng cách trên */
  }

  /* Nhóm: Tab 2 - Biểu đồ */
  canvas#monthlyChart {
    width: 100% !important; /* Chiều rộng đầy đủ */
    height: auto !important; /* Chiều cao tự động */
    max-width: 600px !important; /* Chiều rộng tối đa */
    min-height: 400px; /* Chiều cao tối thiểu */
    max-height: 500px; /* Chiều cao tối đa */
    display: block; /* Hiển thị dạng khối */
    margin: 0 auto; /* Căn giữa */
    background: var(--card-bg); /* Màu nền */
    border-radius: 16px; /* Bo góc */
    padding: 10px; /* Khoảng cách bên trong */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* Đổ bóng */
  }

  .monthly-legend {
    width: 100%; /* Chiều rộng đầy đủ */
    max-width: 700px; /* Chiều rộng tối đa */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột (đã sửa theo yêu cầu: 1 cột duy nhất) */
    font-size: 1rem; /* Kích thước chữ */
    padding: 0 20px; /* Khoảng cách trái/phải */
    margin: 2rem auto 0; /* Khoảng cách trên và căn giữa */
    gap: 1rem; /* Khoảng cách giữa các phần tử */
  }

  .monthly-column {
    width: 100%; /* Chiều rộng đầy đủ */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    gap: 1.5rem; /* Khoảng cách giữa các tháng */
    text-align: left; /* Căn trái */
    min-width: 0; /* Không có chiều rộng tối thiểu */
  }

  .month-item { 
    text-align: left; /* Căn trái */
    white-space: nowrap; /* Không xuống dòng */
  }

  .month-item h3 { 
    font-size: 1.2rem; /* Kích thước tiêu đề */
    margin-bottom: 0.5rem; /* Khoảng cách dưới */
    font-weight: 500; /* Độ đậm trung bình */
    white-space: nowrap; /* Không xuống dòng */
  }

  .month-item p {
    margin: 0.5rem 0; /* Khoảng cách trên/dưới */
    font-size: 1rem; /* Kích thước chữ */
    display: flex; /* Sắp xếp ngang */
    align-items: center; /* Căn giữa dọc */
    white-space: nowrap; /* Không xuống dòng */
  }

  .month-item .color-box {
    width: 16px; height: 16px; /* Kích thước ô màu */
    margin-right: 0.75rem; /* Khoảng cách phải */
    display: inline-block; /* Hiển thị inline */
    border-radius: 4px; /* Bo góc */
    flex-shrink: 0; /* Không thu nhỏ */
  }

  .month-item .amount { 
    font-weight: 700; /* Đậm */
    margin-left: 0.5rem; /* Khoảng cách trái */
  }

  .month-item .difference { 
    font-weight: 700; /* Đậm */
    margin-left: 0.5rem; /* Khoảng cách trái */
  }

  .month-item .difference-icon { 
    margin-right: 0.5rem; /* Khoảng cách phải */
    font-size: 0.8rem; /* Kích thước icon */
  }

  .difference.positive { color: #10B981; } /* Màu cho chênh lệch dương */
  .difference.negative { color: #EF4444; } /* Màu cho chênh lệch âm */
  .difference-icon.positive { color: #10B981; } /* Màu icon dương */
  .difference-icon.negative { color: #EF4444; } /* Màu icon âm */

  /* Nhóm: Tab 3 - Giới thiệu */
  .info-section {
    width: 100%; /* Chiều rộng đầy đủ */
    max-width: 500px; /* Chiều rộng tối đa */
    margin: 0 auto; /* Căn giữa */
    padding: 0 20px; /* Khoảng cách trái/phải */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    gap: 0.5rem; /* Khoảng cách giữa các thẻ */
  }

  .info-card {
    background: var(--card-bg); /* Màu nền */
    border-radius: 16px; /* Bo góc */
    padding: 1.5rem; /* Khoảng cách bên trong */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Đổ bóng */
    transition: transform 0.3s ease, box-shadow 0.3s ease; /* Hiệu ứng */
  }

  .info-card:hover {
    transform: translateY(-5px); /* Nâng lên khi hover */
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); /* Đổ bóng lớn hơn */
  }

  .info-card h2 {
    font-size: 1.5rem; /* Kích thước tiêu đề */
    font-weight: 600; /* Đậm */
    margin-bottom: 1rem; /* Khoảng cách dưới */
    color: var(--text-color); /* Màu chữ */
    border-left: 4px solid var(--primary-color); /* Viền trái */
    padding-left: 0.75rem; /* Khoảng cách trái */
  }

  .info-card p {
    margin: 0.75rem 0; /* Khoảng cách trên/dưới */
    font-size: 1rem; /* Kích thước chữ */
    line-height: 1.6; /* Khoảng cách dòng */
    display: flex; /* Sắp xếp ngang */
    align-items: center; /* Căn giữa dọc */
    gap: 10px; /* Khoảng cách giữa các phần tử */
    color: var(--text-color); /* Màu chữ */
  }

  .info-card p strong {
    font-weight: 500; /* Độ đậm trung bình */
    color: var(--text-color); /* Màu chữ */
  }

  .info-card a {
    color: var(--primary-color); /* Màu liên kết */
    text-decoration: none; /* Không gạch chân */
    transition: color 0.3s ease; /* Hiệu ứng màu */
  }

  .info-card a:hover {
    color: var(--accent-color); /* Màu khi hover */
    text-decoration: underline; /* Gạch chân khi hover */
  }

  .custom-text {
    text-align: justify; /* Căn đều */
    font-style: italic; /* Chữ nghiêng */
    font-size: 1rem; /* Kích thước chữ */
    color: var(--secondary-color); /* Màu chữ */
    line-height: 1.6; /* Khoảng cách dòng */
  }

  .qr-container {
    text-align: center; /* Căn giữa */
    margin: 0; /* Không có lề */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    align-items: center; /* Căn giữa ngang */
    gap: 0.5rem; /* Khoảng cách giữa các phần tử */
  }

  .qr-frame {
    display: inline-block; /* Hiển thị inline */
    padding: 1rem; /* Khoảng cách bên trong */
    background: var(--card-bg); /* Màu nền */
    border-radius: 16px; /* Bo góc */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Đổ bóng */
    transition: transform 0.3s ease, box-shadow 0.3s ease; /* Hiệu ứng */
  }

  .qr-frame:hover {
    transform: scale(1.05); /* Phóng to khi hover */
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); /* Đổ bóng lớn hơn */
  }

  .qr-image {
    max-width: 100%; /* Chiều rộng tối đa */
    width: 400px; /* Chiều rộng cố định */
    height: auto; /* Chiều cao tự động */
    border-radius: 12px; /* Bo góc */
  }

  .qr-caption {
    margin-top: 0.5rem; /* Khoảng cách trên */
    font-size: 1rem; /* Kích thước chữ */
    color: var(--secondary-color); /* Màu chữ */
    font-style: italic; /* Chữ nghiêng */
  }

  .cta-button {
    display: inline-block; /* Hiển thị inline */
    margin-top: 0; /* Không có lề trên */
    padding: 0.75rem 1.5rem; /* Khoảng cách bên trong */
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)); /* Gradient nền */
    color: white; /* Màu chữ */
    border-radius: 12px; /* Bo góc */
    text-decoration: none; /* Không gạch chân */
    font-weight: 500; /* Độ đậm trung bình */
    transition: transform 0.3s ease, background 0.3s ease; /* Hiệu ứng */
  }

  .cta-button:hover {
    transform: translateY(-3px); /* Nâng lên khi hover */
    background: linear-gradient(135deg, var(--gradient-end), var(--gradient-start)); /* Đổi gradient */
  }

  .contact-columns {
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    gap: 0.5rem; /* Khoảng cách giữa các cột */
    width: 100%; /* Chiều rộng đầy đủ */
  }

  .highlight-color {
    color: var(--primary-color); /* Màu nổi bật */
  }

  /* Nhóm: Tab 4 - Giao dịch */
  .transaction-box {
    padding: 1rem; /* Khoảng cách bên trong */
    width: 100%; /* Chiều rộng đầy đủ */
    max-width: 600px; /* Chiều rộng tối đa */
    border-radius: 16px; /* Bo góc */
    font-size: 1rem; /* Kích thước chữ */
    display: flex; /* Sắp xếp nội dung */
    flex-direction: column; /* Theo cột */
    align-items: flex-start; /* Căn trái */
    background: linear-gradient(135deg, #F8FAFC, #E5E7EB); /* Gradient nền */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* Đổ bóng */
    transition: transform 0.2s; /* Hiệu ứng di chuyển */
    margin-bottom: 1rem; /* Khoảng cách dưới */
    margin-left: auto; /* Căn giữa (đã sửa theo yêu cầu) */
    margin-right: auto; /* Căn giữa (đã sửa theo yêu cầu) */
  }

  .transaction-box:hover { 
    transform: translateY(-5px); /* Nâng lên khi hover */
  }

  .transaction-box .date {
    font-weight: 500; /* Độ đậm trung bình */
    font-size: 1.1rem; /* Kích thước chữ */
    color: var(--text-color); /* Màu chữ */
    margin-bottom: 0.5rem; /* Khoảng cách dưới */
  }

  .transaction-box .amount {
    font-weight: 700; /* Đậm */
    font-size: 1.2rem; /* Kích thước chữ */
    margin-bottom: 0.5rem; /* Khoảng cách dưới */
  }

  .transaction-box .type {
    font-size: 1rem; /* Kích thước chữ */
    margin-bottom: 0.5rem; /* Khoảng cách dưới */
    font-weight: 700; /* Đậm */
  }

  .transaction-box .category {
    font-size: 1rem; /* Kích thước chữ */
    font-style: italic; /* Chữ nghiêng */
    color: var(--secondary-color); /* Màu chữ */
  }

  .transaction-box .type.expense { color: #EF4444; } /* Màu cho chi tiêu */
  .transaction-box .type.income { color: #10B981; } /* Màu cho thu nhập */
  .transaction-box .content {
    font-size: 1rem; /* Kích thước chữ */
    margin-bottom: 0.5rem; /* Khoảng cách dưới */
    white-space: normal; /* Cho phép xuống dòng */
    word-wrap: break-word; /* Ngắt từ */
  }

  /* Nhóm: Media Queries - Responsive Design */
  /* Màn hình nhỏ (max-width: 600px) */
  @media (max-width: 600px) {
    body { padding: 60px 5px 10px; font-size: 0.9rem; }
    h1 { font-size: 1.5rem; margin-bottom: 1rem; }
    .top-nav { height: 50px; padding: 10px 0; }
    .nav-item i { font-size: 1.2rem; }
    .nav-item span { font-size: 0.75rem; }
    .input-group { gap: 0.5rem; padding: 0 5px; }
    select, input[type="date"] { width: 110px; font-size: 0.85rem; padding: 0.6rem; }
    button { padding: 0.6rem 1rem; font-size: 0.85rem; }
    .stats-container { gap: 0.5rem; } /* Giảm khoảng cách */
    .stat-box { 
      width: 100px; max-width: 100px; padding: 0.8rem; 
      min-height: 70px; font-size: 0.8rem; 
    }
    .stat-box .title { font-size: 0.8rem; margin-bottom: 0.5rem; }
    .stat-box .amount { font-size: 1rem; }
    canvas#myChart { max-width: 320px !important; }
    canvas#monthlyChart { max-width: 320px !important; min-height: 250px; max-height: 350px; }
    .custom-legend { flex-direction: column; max-width: 320px; font-size: 0.85rem; gap: 0.4rem; }
    .custom-legend-column { width: 100%; min-width: 0; }
    .legend-text { font-size: 0.85rem; }
    .monthly-legend { max-width: 320px; font-size: 0.85rem; gap: 0.4rem; padding: 0 10px; }
    .monthly-column { width: 100%; min-width: 0; gap: 1rem; }
    .month-item h3 { font-size: 0.95rem; }
    .month-item p { font-size: 0.85rem; }
    .info-section { padding: 0 10px; gap: 0.4rem; max-width: 400px; }
    .info-card { padding: 0.8rem; }
    .info-card h2 { font-size: 1.2rem; margin-bottom: 0.8rem; }
    .info-card p, .custom-text { font-size: 0.85rem; line-height: 1.4; }
    .qr-image { width: 250px; }
    .qr-caption { font-size: 0.8rem; }
    .cta-button { padding: 0.5rem 1rem; font-size: 0.85rem; }
    .transaction-box { padding: 0.8rem; max-width: 320px; margin-bottom: 0.8rem; }
    .transaction-box .date { font-size: 0.95rem; }
    .transaction-box .amount { font-size: 1.2rem; }
    .transaction-box .type { font-size: 0.9rem; }
    .transaction-box .category { font-size: 0.85rem; }
    .transaction-box .content { font-size: 0.85rem; }
  }

  /* Màn hình trung bình (601px - 1023px) */
  @media (min-width: 601px) and (max-width: 1023px) {
    body { padding: 70px 20px 20px; }
    h1 { font-size: 1.8rem; }
    .stats-container { gap: 1.5rem; }
    .stat-box { width: 130px; padding: 1rem; max-width: 130px; }
    .stat-box .title { font-size: 0.95rem; }
    .stat-box .amount { font-size: 1.2rem; }
    canvas#myChart { max-width: 450px !important; }
    canvas#monthlyChart { max-width: 500px !important; min-height: 350px; max-height: 450px; }
    .custom-legend { max-width: 550px; font-size: 0.95rem; gap: 0.3rem; }
    .custom-legend-column { width: 48%; min-width: 260px; }
    .legend-text { font-size: 0.95rem; }
    .monthly-legend { max-width: 650px; font-size: 0.95rem; gap: 0.5rem; }
    .monthly-column { width: 100%; min-width: 0; }
    .month-item h3 { font-size: 1.1rem; }
    .month-item p { font-size: 0.95rem; }
    select, input[type="date"] { width: 150px; font-size: 0.95rem; }
    button { padding: 0.8rem 1.5rem; font-size: 0.95rem; }
    .top-nav { height: 55px; }
    .nav-item i { font-size: 1.4rem; }
    .nav-item span { font-size: 0.9rem; }
    .info-card h2 { font-size: 1.4rem; }
    .info-card p, .custom-text { font-size: 0.95rem; }
    .qr-image { width: 350px; }
    .qr-caption { margin-top: 0.5rem; }
    .cta-button { padding: 0.7rem 1.3rem; font-size: 0.95rem; margin-top: 0; }
  }

  /* Màn hình lớn (min-width: 1024px) */
  @media (min-width: 1024px) {
    .content-wrapper { max-width: 800px; }
    body { padding: 80px 30px 30px; }
    h1 { font-size: 2rem; }
    .stats-container { gap: 2rem; }
    .stat-box { width: 140px; padding: 1rem; max-width: 140px; }
    .stat-box .title { font-size: 1rem; }
    .stat-box .amount { font-size: 1.3rem; }
    canvas#myChart { max-width: 500px !important; }
    canvas#monthlyChart { max-width: 600px !important; min-height: 400px; max-height: 500px; }
    .custom-legend { max-width: 600px; font-size: 1rem; gap: 0.3rem; }
    .custom-legend-column { width: 48%; min-width: 280px; }
    .legend-text { font-size: 1rem; }
    .monthly-legend { max-width: 700px; font-size: 1rem; gap: 0.5rem; }
    .monthly-column { width: 100%; min-width: 0; }
    .month-item h3 { font-size: 1.2rem; }
    .month-item p { font-size: 1rem; }
    .info-card h2 { font-size: 1.5rem; }
    .info-card p, .custom-text { font-size: 1rem; }
    .qr-image { width: 400px; }
    .qr-caption { margin-top: 0.5rem; }
    .cta-button { padding: 0.75rem 1.5rem; font-size: 1rem; margin-top: 0; }
  }
</style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>
<body>
  <div class="top-nav">
    <div class="nav-item active" data-tab="tab4">
      <i class="fas fa-list"></i>
      <span>Giao dịch</span>
    </div>
    <div class="nav-item" data-tab="tab1">
      <i class="fas fa-table"></i>
      <span>Thống kê</span>
    </div>
    <div class="nav-item" data-tab="tab2">
      <i class="fas fa-chart-bar"></i>
      <span>Biểu đồ</span>
    </div>
    <div class="nav-item" data-tab="tab3">
      <i class="fas fa-info-circle"></i>
      <span>Giới thiệu</span>
    </div>
  </div>

  <div class="content-wrapper">
    <div id="tab1" class="tab-content">
  <h1>THỐNG KÊ</h1>
  <p class="notification">Vui lòng chọn khoảng thời gian và ấn "Lọc" để xem dữ liệu.</p>
  <div class="input-group">
    Từ: <input type="date" id="startDate"> 
    Đến: <input type="date" id="endDate"> 
    <button id="fetchDataBtn">Lọc</button>
  </div>
  <!-- Gộp tất cả stat-box vào một stats-container -->
  <div class="stats-container" id="statsContainer">
    <div class="stat-box income">
        <div class="title">Tổng thu nhập</div>
        <div class="amount">0đ</div>
    </div>
    <div class="stat-box expense">
        <div class="title">Tổng chi tiêu</div>
        <div class="amount">0đ</div>
    </div>
    <div class="stat-box balance">
        <div class="title">Số dư</div>
        <div class="amount">0đ</div>
    </div>
  </div>
  <div class="chart-container">
    <h2>BIỂU ĐỒ CHI TIÊU</h2>
    <canvas id="myChart"></canvas>
  </div>
  <div class="custom-legend" id="customLegend"></div>
</div>

    <div id="tab2" class="tab-content">
      <h1>BIỂU ĐỒ THU CHI THEO THÁNG</h1>
      <p class="notification">Vui lòng chọn khoảng thời gian và ấn "Lọc" để xem dữ liệu.</p>
      <div class="input-group">
        Từ: 
        <select id="startMonth">
          <option value="1">Tháng 1</option>
          <option value="2">Tháng 2</option>
          <option value="3">Tháng 3</option>
          <option value="4">Tháng 4</option>
          <option value="5">Tháng 5</option>
          <option value="6">Tháng 6</option>
          <option value="7">Tháng 7</option>
          <option value="8">Tháng 8</option>
          <option value="9">Tháng 9</option>
          <option value="10">Tháng 10</option>
          <option value="11">Tháng 11</option>
          <option value="12">Tháng 12</option>
        </select>
        Đến: 
        <select id="endMonth">
          <option value="1">Tháng 1</option>
          <option value="2">Tháng 2</option>
          <option value="3">Tháng 3</option>
          <option value="4">Tháng 4</option>
          <option value="5">Tháng 5</option>
          <option value="6">Tháng 6</option>
          <option value="7">Tháng 7</option>
          <option value="8">Tháng 8</option>
          <option value="9">Tháng 9</option>
          <option value="10">Tháng 10</option>
          <option value="11">Tháng 11</option>
          <option value="12">Tháng 12</option>
        </select>
        <button id="fetchMonthlyDataBtn">Lọc</button>
      </div>
      <div class="chart-container">
        <canvas id="monthlyChart"></canvas>
        <div class="monthly-legend" id="monthlyLegend"></div>
      </div>
    </div>

    <div id="tab3" class="tab-content">
      <h1>GIỚI THIỆU</h1>
      <div class="info-section">
        <div class="info-card">
          <h2>Về MiniApp</h2>
          <p class="custom-text">
            Miniapp tài chính trên Telegram giúp bạn theo dõi thu nhập và chi tiêu dễ dàng. Dựa vào dữ liệu trong Google Sheet nó sẽ hiển thị danh sách giao dịch trong ngày, biểu đồ chi tiêu theo phân loại chi tiết và biểu đồ thu nhập – chi tiêu hàng tháng ngay trong Telegram. 
          </p>
        </div>
        <div class="info-card">
          <h2>Ủng hộ</h2>
          <p class="custom-text">
            Nếu bạn thấy nó hữu ích, hãy ủng hộ mình một ly cà phê để có thêm động lực duy trì và phát triển nhé!
          </p>
          <p><i class="fas fa-university" style="color: var(--accent-color);"></i><strong>Ngân hàng:</strong> TMCP Sài Gòn – Hà Nội (SHB)</p>
          <p><i class="fas fa-user" style="color: var(--accent-color);"></i><strong>Chủ tài khoản:</strong> Hoang Manh Hung</p>
          <p><i class="fas fa-credit-card" style="color: var(--accent-color);"></i><strong>Số tài khoản:</strong> 6666.6789.9999</p>
        </div>
        <div class="qr-container">
          <a href="https://momo.vn/" target="_blank" class="cta-button">Ủng hộ ngay</a>
          <div class="qr-frame">
            <img id="qrImage" src="https://i.pinimg.com/736x/7c/13/53/7c135389e26cbc6460626deb9e2aa5c6.jpg" alt="QR Code" class="qr-image">
          </div>
          <p class="qr-caption">Quét mã QR để ủng hộ qua Momo</p>
        </div>
        <div class="info-card">
			<h2>Liên hệ</h2>
<div class="contact-columns">
    <p><i class="fas fa-user" style="color: var(--primary-color);"></i><strong>Người tạo:</strong> <span class="highlight-color">Hoàng Hùng</span></p>
    <p><i class="fab fa-telegram-plane" style="color: var(--primary-color);"></i><strong>Telegram:</strong> <a href="https://t.me/masterhmh" target="_blank">@masterhmh</a></p>
    <p><i class="fab fa-facebook" style="color: var(--primary-color);"></i><strong>Facebook:</strong> <a href="https://facebook.com/masterhmh" target="_blank">facebook.com/masterhmh</a></p>
    <p><i class="fas fa-envelope" style="color: var(--primary-color);"></i><strong>Email:</strong> <a href="mailto:masterhmh@gmail.com">masterhmh@gmail.com</a></p>
  </div>
</div>
    </div>
  </div>
</div>

    <div id="tab4" class="tab-content active">
    <h1>GIAO DỊCH TRONG NGÀY</h1>
    <p class="notification">Vui lòng chọn ngày và ấn "Lọc" để xem dữ liệu.</p>
    <div class="input-group">
        Ngày: <input type="date" id="transactionDate">
        <button id="fetchTransactionsBtn">Lọc</button>
    </div>
    <div class="stats-container" id="dailySummary">
    <div class="stat-box income">
        <div class="title">Tổng thu nhập</div>
        <div class="amount">0đ</div>
    </div>
    <div class="stat-box expense">
        <div class="title">Tổng chi tiêu</div>
        <div class="amount">0đ</div>
    </div>
    <div class="stat-box balance">
        <div class="title">Số dư</div>
        <div class="amount">0đ</div>
    </div>
</div>
    <div class="stats-container" id="transactionsContainer">
        <!-- Giao dịch sẽ được hiển thị ở đây -->
    </div>
</div>

  <script>
    // Lấy api và sheetId từ query string
    const urlParams = new URLSearchParams(window.location.search);
    const apiUrl = urlParams.get('api');
    const sheetId = urlParams.get('sheetId');

    if (!apiUrl || !sheetId) {
        alert("Thiếu thông tin API hoặc Sheet ID. Vui lòng kiểm tra lại URL!");
    }

    window.openTab = function(tabId) {
        console.log("Opening tab: " + tabId);
        const tabs = document.querySelectorAll('.nav-item');
        const contents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.remove('active'));
        contents.forEach(content => content.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
    };

    window.fetchData = async function() {
        const startDateInput = document.getElementById('startDate').value;
        const endDateInput = document.getElementById('endDate').value;
        console.log("Fetching data from: " + startDateInput + " to: " + endDateInput);
        if (!startDateInput || !endDateInput) {
            alert("Vui lòng chọn khoảng thời gian!");
            return;
        }
        const startDate = new Date(startDateInput);
        const endDate = new Date(endDateInput);
        if (startDate > endDate) {
            alert("Ngày bắt đầu không thể lớn hơn ngày kết thúc!");
            return;
        }

        try {
            const financialResponse = await fetch(`${apiUrl}?action=getFinancialSummary&startDate=${startDateInput}&endDate=${endDateInput}&sheetId=${sheetId}`);
            const financialData = await financialResponse.json();
            console.log("Financial data received: ", financialData);
            if (financialData.error) {
                throw new Error(financialData.error);
            }
            updateFinancialData(financialData);

            const chartResponse = await fetch(`${apiUrl}?action=getChartData&startDate=${startDateInput}&endDate=${endDateInput}&sheetId=${sheetId}`);
            const chartData = await chartResponse.json();
            console.log("Chart data received: ", chartData);
            if (chartData.error) {
                throw new Error(chartData.error);
            }
            updateChartData(chartData);
        } catch (error) {
            console.error("Error fetching data: ", error);
            alert("Lỗi khi lấy dữ liệu: " + error.message);
            updateFinancialData({ error: true });
        }
    };

    function updateFinancialData(data) {
    console.log("Updating financial data with: ", data);
    const container = document.getElementById('statsContainer');
    if (!data || data.error || Object.keys(data).length === 0) {
        console.log("No data or error detected");
        container.innerHTML = `
            <div class="stat-box income">
                <div class="title">Tổng thu nhập</div>
                <div class="amount">Không có dữ liệu</div>
            </div>
            <div class="stat-box expense">
                <div class="title">Tổng chi tiêu</div>
                <div class="amount">Không có dữ liệu</div>
            </div>
            <div class="stat-box balance">
                <div class="title">Số dư</div>
                <div class="amount">Không có dữ liệu</div>
            </div>
        `;
        return;
    }
    const totalIncome = Number(data.income) || 0;
    const totalExpense = Number(data.expense) || 0;
    const balance = totalIncome - totalExpense;
    container.innerHTML = `
        <div class="stat-box income">
            <div class="title">Tổng thu nhập</div>
            <div class="amount">${totalIncome.toLocaleString('vi-VN')}đ</div>
        </div>
        <div class="stat-box expense">
            <div class="title">Tổng chi tiêu</div>
            <div class="amount">${totalExpense.toLocaleString('vi-VN')}đ</div>
        </div>
        <div class="stat-box balance">
            <div class="title">Số dư</div>
            <div class="amount">${balance.toLocaleString('vi-VN')}đ</div>
        </div>
    `;
}

    function updateChartData(response) {
        if (response.error) {
            alert(response.error);
            if (window.myChart && typeof window.myChart.destroy === 'function') {
                window.myChart.destroy();
            }
            return;
        }
        const chartData = response.chartData;
        const categories = response.categories;
        const ctx = document.getElementById('myChart').getContext('2d');
        if (window.myChart && typeof window.myChart.destroy === 'function') {
            window.myChart.destroy();
        }
        const totalAmount = chartData.reduce((sum, item) => sum + item.amount, 0);
        const backgroundColors = [
            '#FF6B6B', '#FF9F45', '#FFE156', '#7DC95E', '#40C4FF',
            '#5A92FF', '#9B5DE5', '#FF66C4', '#FF7D7D', '#F88F70',
            '#54A0FF', '#C084FC', '#FF82A9', '#6DCFF6', '#FFACC5',
            '#E4C1F9', '#FF928B', '#FDCB98', '#B5E2FA', '#91E8BC',
            '#FFD166', '#FF8E72', '#E57373', '#74D3AE', '#43BCCD',
            '#D1B3E0', '#F78F8F', '#F6B17A', '#F4A261', '#FF6392',
            '#66D9E8', '#FF85A1', '#6A0572', '#FC7A57', '#A29BFE'
        ];
        const customLegend = document.getElementById('customLegend');
        customLegend.innerHTML = '';
        const leftColumn = document.createElement('div');
        leftColumn.className = 'custom-legend-column';
        const rightColumn = document.createElement('div');
        rightColumn.className = 'custom-legend-column';
        chartData.forEach((item, i) => {
            const index = categories.indexOf(item.category);
            const color = backgroundColors[index % backgroundColors.length];
            const percentage = ((item.amount / totalAmount) * 100).toFixed(1);
            const legendItem = document.createElement('div');
            legendItem.className = 'legend-item';
            legendItem.innerHTML = `
                <span class="legend-color" style="background-color: ${color};"></span>
                <span class="legend-text">
                    ${item.category}:
                    <span class="legend-value">${item.amount.toLocaleString('vi-VN')}đ (${percentage}%)</span>
                </span>
            `;
            if (i % 2 === 0) {
                leftColumn.appendChild(legendItem);
            } else {
                rightColumn.appendChild(legendItem);
            }
        });
        customLegend.appendChild(leftColumn);
        customLegend.appendChild(rightColumn);
        window.myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: chartData.map(item => item.category),
                datasets: [{
                    data: chartData.map(item => item.amount),
                    backgroundColor: chartData.map(item => {
                        const index = categories.indexOf(item.category);
                        return backgroundColors[index % backgroundColors.length];
                    })
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 1,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(tooltipItem) {
                                const category = tooltipItem.label;
                                const amount = tooltipItem.raw;
                                const percentage = ((amount / totalAmount) * 100).toFixed(1);
                                return `${category}: ${amount.toLocaleString('vi-VN')}đ (${percentage}%)`;
                            }
                        },
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleFont: { size: 12 },
                        bodyFont: { size: 10 },
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 8,
                        displayColors: true,
                    },
                    datalabels: {
                        formatter: (value, context) => {
                            const percentage = ((value / totalAmount) * 100).toFixed(1);
                            return percentage >= 1 ? `${value.toLocaleString('vi-VN')}đ (${percentage}%)` : '';
                        },
                        color: '#fff',
                        font: { weight: 'bold', size: 12 },
                        anchor: 'end',
                        align: 'end',
                        clamp: true
                    }
                }
            }
        });
    }

   window.fetchMonthlyData = async function() {
    const startMonth = parseInt(document.getElementById('startMonth').value);
    const endMonth = parseInt(document.getElementById('endMonth').value);
    const year = new Date().getFullYear();
    console.log("Fetching monthly data from month: " + startMonth + " to: " + endMonth);
    if (startMonth > endMonth) {
        alert("Tháng bắt đầu không thể lớn hơn tháng kết thúc!");
        return;
    }

    try {
        const response = await fetch(`${apiUrl}?action=getMonthlyData&year=${year}&sheetId=${sheetId}`);
        const monthlyData = await response.json();
        console.log("Monthly data received: ", monthlyData);
        if (monthlyData.error) {
            throw new Error(monthlyData.error);
        }
        // Đảm bảo dữ liệu từ tháng 1 đến tháng 12
        const fullYearData = Array.from({ length: 12 }, (_, i) => {
            const month = i + 1;
            const existingData = monthlyData.find(item => item.month === month);
            return existingData || { month, income: 0, expense: 0 };
        });
        updateMonthlyChart(fullYearData, startMonth, endMonth);
    } catch (error) {
        console.error("Error fetching monthly data: ", error);
        alert("Lỗi khi lấy dữ liệu biểu đồ tháng: " + error.message);
        updateMonthlyChart({ error: true }, startMonth, endMonth);
    }
};

function updateMonthlyChart(monthlyData, startMonth, endMonth) {
    console.log("Updating monthly chart with data: ", monthlyData);
    const ctx = document.getElementById('monthlyChart').getContext('2d');
    if (window.monthlyChart && typeof window.monthlyChart.destroy === 'function') {
        window.monthlyChart.destroy();
    }
    const filteredData = monthlyData.filter(item => item.month >= startMonth && item.month <= endMonth);
    if (!filteredData || filteredData.length === 0 || monthlyData.error) {
        window.monthlyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Không có dữ liệu'],
                datasets: [
                    { label: 'Thu nhập', data: [0], backgroundColor: '#10B981' },
                    { label: 'Chi tiêu', data: [0], backgroundColor: '#EF4444' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 1,
                scales: {
                    y: { 
                        beginAtZero: true, 
                        title: { display: true, text: 'Số tiền (đ)', font: { size: 14 } }, 
                        ticks: { font: { size: 12 } } 
                    },
                    x: { 
                        title: { display: true, text: 'Tháng', font: { size: 14 } }, 
                        ticks: { font: { size: 12 } } 
                    }
                },
                plugins: {
                    legend: { display: true, labels: { font: { size: 12 } } },
                    tooltip: {
                        titleFont: { size: 12 },
                        bodyFont: { size: 12 },
                        callbacks: {
                            label: function(tooltipItem) {
                                return `${tooltipItem.dataset.label}: ${tooltipItem.raw.toLocaleString('vi-VN')}đ`;
                            }
                        }
                    },
                    datalabels: { display: false }
                }
            }
        });
        document.getElementById('monthlyLegend').innerHTML = '<div>Không có dữ liệu</div>';
        return;
    }
    const labels = monthlyData.map(item => `Tháng ${item.month}`); // Hiển thị đủ 12 tháng
    const incomes = monthlyData.map(item => item.income);
    const expenses = monthlyData.map(item => item.expense);
    window.monthlyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                { label: 'Thu nhập', data: incomes, backgroundColor: '#10B981', borderColor: '#10B981', borderWidth: 1 },
                { label: 'Chi tiêu', data: expenses, backgroundColor: '#EF4444', borderColor: '#EF4444', borderWidth: 1 }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Số tiền (đ)', font: { size: 14 } },
                    ticks: {
                        callback: function(value) { return value.toLocaleString('vi-VN') + 'đ'; },
                        font: { size: 12 }
                    }
                },
                x: {
                    title: { display: true, text: 'Tháng', font: { size: 14 } },
                    ticks: { font: { size: 12 } }
                }
            },
            plugins: {
                legend: { display: true, labels: { font: { size: 12 } } },
                tooltip: {
                    titleFont: { size: 12 },
                    bodyFont: { size: 12 },
                    callbacks: {
                        label: function(tooltipItem) {
                            return `${tooltipItem.dataset.label}: ${tooltipItem.raw.toLocaleString('vi-VN')}đ`;
                        }
                    }
                },
                datalabels: {
                    display: true,
                    align: 'end',
                    anchor: 'end',
                    formatter: (value) => value.toLocaleString('vi-VN') + 'đ',
                    color: '#1F2A44',
                    font: { weight: 'bold', size: 12 }
                }
            }
        }
    });
    const monthlyLegend = document.getElementById('monthlyLegend');
    monthlyLegend.innerHTML = '';
    const column = document.createElement('div');
    column.className = 'monthly-column';
    monthlyData.forEach(item => { // Hiển thị đủ 12 tháng
        const difference = item.income - item.expense;
        const diffClass = difference >= 0 ? 'positive' : 'negative';
        const diffIcon = difference >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
        const monthItem = document.createElement('div');
        monthItem.className = 'month-item';
        monthItem.innerHTML = `
            <h3>Tháng ${item.month}:</h3>
            <p><span class="color-box" style="background-color: #10B981;"></span>Tổng thu nhập: <strong>${item.income.toLocaleString('vi-VN')}đ</strong></p>
            <p><span class="color-box" style="background-color: #EF4444;"></span>Tổng chi tiêu: <strong>${item.expense.toLocaleString('vi-VN')}đ</strong></p>
            <p><i class="fas ${diffIcon} difference-icon ${diffClass}"></i>Chênh lệch: <span class="difference ${diffClass}"><strong>${difference.toLocaleString('vi-VN')}đ</strong></span></p>
        `;
        column.appendChild(monthItem);
    });
    monthlyLegend.appendChild(column);
}

    function displayTransactions(data) {
        console.log("Dữ liệu nhận được: ", data);
        const container = document.getElementById('transactionsContainer');
        const summaryContainer = document.getElementById('dailySummary');
        container.innerHTML = '';
        if (data.error || !data || data.length === 0) {
            console.log("Không có giao dịch để hiển thị");
            container.innerHTML = '<div>Không có giao dịch trong ngày này</div>';
            summaryContainer.innerHTML = `
                <div class="stat-box income">
                    <div class="title">Tổng thu nhập</div>
                    <div class="amount">Không có dữ liệu</div>
                </div>
                <div class="stat-box expense">
                    <div class="title">Tổng chi tiêu</div>
                    <div class="amount">Không có dữ liệu</div>
                </div>
                <div class="stat-box balance">
                    <div class="title">Số dư</div>
                    <div class="amount">Không có dữ liệu</div>
                </div>
            `;
            return;
        }
        let totalIncome = 0;
        let totalExpense = 0;
        data.forEach(item => {
            if (item.type === 'Thu nhập') {
                totalIncome += item.amount;
            } else if (item.type === 'Chi tiêu') {
                totalExpense += item.amount;
            }
        });
        const balance = totalIncome - totalExpense;
        summaryContainer.innerHTML = `
            <div class="stat-box income">
                <div class="title">Tổng thu nhập</div>
                <div class="amount">${totalIncome.toLocaleString('vi-VN')}đ</div>
            </div>
            <div class="stat-box expense">
                <div class="title">Tổng chi tiêu</div>
                <div class="amount">${totalExpense.toLocaleString('vi-VN')}đ</div>
            </div>
            <div class="stat-box balance">
                <div class="title">Số dư</div>
                <div class="amount">${balance.toLocaleString('vi-VN')}đ</div>
            </div>
        `;
        console.log("Hiển thị giao dịch: ", data.slice(0, 10));
        const limitedData = data.slice(0, 10);
        limitedData.forEach(item => {
            const transactionBox = document.createElement('div');
            transactionBox.className = 'transaction-box';
            const amountColor = item.type === 'Thu nhập' ? '#10B981' : '#EF4444';
            const typeClass = item.type === 'Thu nhập' ? 'income' : 'expense';
            transactionBox.innerHTML = `
                <div style="display: flex; justify-content: space-between; width: 100%;">
                    <div style="flex: 1;">
                        <div class="date">${item.date}</div>
                        <div class="amount" style="font-size: 1.5rem; color: ${amountColor}">${item.amount.toLocaleString('vi-VN')}đ</div>
                        <div class="content">Nội dung: ${item.content}${item.note ? ` (${item.note})` : ''}</div>
                    </div>
                    <div style="flex: 1; text-align: right;">
                        <div class="type ${typeClass}">Phân loại: ${item.type}</div>
                        <div class="category">Phân loại chi tiết: ${item.category}</div>
                    </div>
                </div>
            `;
            container.appendChild(transactionBox);
        });
    }

    function getCurrentMonthRange() {
        const now = new Date();
        const startDate = new Date(now.getFullYear(), now.getMonth(), 1);
        const endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
        return {
            startDate: formatDateToYYYYMMDD(startDate),
            endDate: formatDateToYYYYMMDD(endDate)
        };
    }

    function formatDateToYYYYMMDD(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    document.addEventListener('DOMContentLoaded', function() {
        console.log("Document loaded, initializing...");
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                window.openTab(tabId);
            });
        });
        const fetchDataBtn = document.getElementById('fetchDataBtn');
        fetchDataBtn.addEventListener('click', window.fetchData);
        const fetchMonthlyDataBtn = document.getElementById('fetchMonthlyDataBtn');
        fetchMonthlyDataBtn.addEventListener('click', window.fetchMonthlyData);
        const fetchTransactionsBtn = document.getElementById('fetchTransactionsBtn');
        fetchTransactionsBtn.addEventListener('click', window.fetchTransactions);
        const { startDate, endDate } = getCurrentMonthRange();
        document.getElementById('startDate').value = startDate;
        document.getElementById('endDate').value = endDate;
        document.getElementById('startMonth').value = 1;
        document.getElementById('endMonth').value = 12;
        document.getElementById('transactionDate').value = formatDateToYYYYMMDD(new Date());
        window.openTab('tab4');
        const qrImage = document.getElementById('qrImage');
        qrImage.src = 'https://i.pinimg.com/736x/7c/13/53/7c135389e26cbc6460626deb9e2aa5c6.jpg';
        qrImage.onerror = function() {
            qrImage.src = 'https://via.placeholder.com/300';
        };
    });
</script>
</body>
</html>
