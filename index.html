<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Mini App t·ªïng quan chi ti√™u</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
/* Nh√≥m: C√°c bi·∫øn to√†n c·ª•c */
:root {
  --primary-color: #3B82F6; /* Blue-500 */
  --secondary-color: #6B7280; /* Gray-500 */
  --background-color: #F3F4F6; /* Gray-100 */
  --card-bg: #FFFFFF;
  --text-color: #111827; /* Gray-900 */
  --gradient-start: #3B82F6; /* Blue-500 */
  --gradient-end: #60A5FA; /* Blue-400 */
  --accent-color: #3B82F6; /* Blue-500 */
}
/* Dark Mode */
@media (prefers-color-scheme: dark) {
  :root {
    --primary-color: #4F9AFF;
    --secondary-color: #8B9098;
    --background-color: #181A1B;
    --card-bg: #1C1E1F;
    --text-color: #E4E7EB;
    --gradient-start: #3B82F6;
    --gradient-end: #7C3AED;
    --income-color: #2ECC71;
    --expense-color: #E74C3C;        
    --balance-color: #3498DB;        
    --edit-btn-color: #0E7490;
    --delete-btn-color: #B91C1C;
    --stat-box-bg-start: #181A1B;
    --stat-box-bg-end: #252729;
    --input-bg: #1E2022;
    --input-border: #45484C;
    --stat-title-color: #E4E7EB;
  }

  /* Stat-box t·ªïng quan (T·ªïng thu nh·∫≠p, T·ªïng chi ti√™u, S·ªë d∆∞) */
  .stat-box {
    background: linear-gradient(135deg, var(--stat-box-bg-start), var(--stat-box-bg-end)) !important;
  }

  .stat-box .title {
    color: var(--stat-title-color) !important;
    font-weight: 700;
    font-size: 1.1rem;
  }

  .stat-box .amount {
    font-weight: 600;
    font-size: 1.25rem;
  }

  .income .amount { color: var(--income-color) !important; }
  .expense .amount { color: var(--expense-color) !important; }
  .balance .amount { color: var(--balance-color) !important; }

  /* Transaction-box (kh·ªëi giao d·ªãch trong tab 1, 2, 3) */
  .transaction-box {
    background: linear-gradient(135deg, var(--stat-box-bg-start), var(--stat-box-bg-end)) !important;
    color: var(--text-color) !important;
    border: 1px solid var(--input-border) !important;
    border-radius: 16px;
    padding: 1rem;
    box-shadow: none !important;
  }

  .transaction-box .date {
    color: var(--text-color) !important;
    font-weight: 500;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
  }

  .transaction-box .amount {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
  }

  .transaction-box .type,
  .transaction-box .content,
  .transaction-box .category {
    color: var(--text-color) !important;
    font-size: 1rem;
    margin-bottom: 0.5rem;
  }

  .transaction-box .id,
  .transaction-box .number {
    color: var(--secondary-color) !important;
    font-size: 0.9rem;
    margin-bottom: 0.3rem;
  }

  .transaction-box .type.expense { color: var(--expense-color) !important; }
  .transaction-box .type.income { color: var(--income-color) !important; }
  .transaction-box .income .amount,
  .transaction-box .type.income + .amount { color: var(--income-color) !important; }
  .transaction-box .expense .amount,
  .transaction-box .type.expense + .amount { color: var(--expense-color) !important; }

  .transaction-box button.edit {
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)) !important;
    color: #E4E7EB !important;
    border: none;
    border-radius: 8px;
    padding: 0.3rem 0.8rem;
    margin-right: 0.5rem;
  }

  .transaction-box button.delete {
    background: linear-gradient(135deg, var(--delete-btn-color), #F87171) !important;
    color: #E4E7EB !important;
    border: none;
    border-radius: 8px;
    padding: 0.3rem 0.8rem;
  }

   /* Transaction-item (d·ª± ph√≤ng n·∫øu HTML d√πng l·ªõp n√†y) */
  .transaction-item {
    background: linear-gradient(135deg, var(--stat-box-bg-start), var(--stat-box-bg-end)) !important;
    color: var(--text-color) !important;
    border: 1px solid var(--input-border) !important;
    border-radius: 4px;
    padding: 12px;
    margin-bottom: 10px;
  }

  .transaction-item .date,
  .transaction-item .code,
  .transaction-item .description {
    color: var(--text-color) !important;
    font-size: 0.95rem;
  }

  .transaction-item .amount {
    font-weight: 600;
    font-size: 1.1rem;
  }

  .transaction-item .income .amount,
  .transaction-item .type.income + .amount { color: var(--income-color) !important; }
  .transaction-item .expense .amount,
  .transaction-item .type.expense + .amount { color: var(--expense-color) !important; }

  .transaction-item button.edit {
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)) !important;
    color: #E4E7EB !important;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
  }

  .transaction-item button.delete {
    background: linear-gradient(135deg, var(--delete-btn-color), #F87171) !important;
    color: #E4E7EB !important;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
  }

  /* Tr∆∞·ªùng nh·∫≠p li·ªáu t·∫•t c·∫£ c√°c tab */
  select,
  input[type="month"],
  input[type="date"],
  input[type="text"],
  input[type="number"] {
    background-color: var_credit_card(--input-bg) !important;
    color: var(--text-color) !important;
    border: 1px solid var(--input-border) !important;
    border-radius: 4px;
  }

  input::placeholder,
  select::placeholder {
    color: var(--secondary-color) !important;
    opacity: 0.8;
  }

  /* Bi·ªÉu t∆∞·ª£ng l·ªãch */
  input[type="date"]::-webkit-calendar-picker-indicator,
  input[type="month"]::-webkit-calendar-picker-indicator {
    filter: invert(90%) !important;
    cursor: pointer;
  }

  /* M≈©i t√™n select */
  select {
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23E4E7EB" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') !important;
    background-position: right 10px center;
    background-repeat: no-repeat;
  }

.popup-content {
    background: linear-gradient(135deg, var(--stat-box-bg-start), var(--stat-box-bg-end)) !important;
    color: var(--text-color) !important;
    box-shadow: 0 4px 20px var(--dark-shadow);
  }

  .popup-content h2,
  .popup-content p,
  .popup-content ul li {
    color: var(--dark-text);
  }

  .popup-content .note {
    color: var(--dark-secondary-text);
  }

  .popup-content label {
    color: var(--dark-text);
  }

  .popup-content .close-btn {
    color: var(--dark-secondary-text);
  }
}
/* Nh√≥m: C·∫•u h√¨nh chung cho trang */
html { 
  font-size: 15px; /* Reduced base font size */
  overflow-x: hidden;
}

body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  padding: 120px 20px 20px; /* Increased padding-top for more space below nav */
  background-color: var(--background-color);
  box-sizing: border-box;
  width: 100%;
  min-width: 320px;
  overflow-x: hidden;
  height: 100vh;
  font-size: 0.9rem; /* Smaller font size */
  color: var(--text-color);
}

.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background-color: var(--card-bg);
  padding: 10px 20px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  z-index: 999;
  height: 40px;
  display: flex;
  align-items: center;
}

.header span {
  font-size: 1rem; /* Slightly smaller header font */
  font-weight: 500;
  color: var(--text-color);
}

.content-wrapper { 
  max-width: 700px; 
  width: 100%; 
  margin: 0 auto; 
  overflow-x: hidden;
}

.tab-content { 
  display: none; 
  width: 100%; 
}

.tab-content.active { 
  display: block; 
}

/* Nh√≥m: Thanh ƒëi·ªÅu h∆∞·ªõng tr√™n c√πng */
.top-nav {
  position: fixed;
  top: 42px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  padding: 15px 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  height: 60px;
  width: 100%;
  max-width: 100%;
  margin: 0;
  overflow-x: hidden;
}

.nav-item {
  flex: 1;
  text-align: center;
  cursor: pointer;
  padding: 5px;
  color: #fff;
  transition: opacity 0.3s, background-color 0.3s;
  font-size: 0.9rem;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.nav-item:hover { opacity: 0.8; }
.nav-item i { font-size: 1.3rem; margin-bottom: 5px; }
.nav-item span { display: block; font-size: 0.8rem; }
.nav-item.active {
  font-weight: 600;
  color: #FFFFFF;
  position: relative;
  border-bottom: none;
}
.nav-item.active::after {
  content: '';
  position: absolute;
  bottom: -2px; left: 50%; transform: translateX(-50%);
  width: 70px; height: 2px;
  background-color: #FFFFFF;
}

/* Nh√≥m: C√°c th√†nh ph·∫ßn giao di·ªán chung */
h1 { 
  font-size: 1.8rem; /* Smaller h1 */
  margin-bottom: 1.8rem; 
  text-align: center; 
  font-weight: 700; 
}

.input-group {
  margin-bottom: 1.3rem;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.8rem;
  width: 100%;
  padding: 0 15px;
  flex-wrap: nowrap;
}

select, input[type="date"] {
  padding: 0.5rem;
  font-size: 0.9rem; /* Smaller input font */
  width: 130px;
  border-radius: 10px;
  border: 1px solid #E5E7EB;
  background-color: var(--card-bg);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  transition: border-color 0.3s;
}

select:focus, input[type="date"]:focus {
  outline: none;
  border-color: var(--primary-color);
}

button {
  padding: 0.5rem 1.3rem;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  color: white;
  border: none;
  cursor: pointer;
  font-size: 0.9rem; /* Smaller button font */
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s;
}

button:hover { 
  transform: translateY(-2px); 
}

.notification {
  text-align: center;
  margin-bottom: 0.9rem;
  font-size: 0.7rem; /* Smaller notification font */
  color: var(--secondary-color);
}

/* Nh√≥m: Th√†nh ph·∫ßn d√πng chung cho Tab 1, Tab 4 */
.stats-container {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  gap: 0.8rem;
  margin-bottom: 1.8rem;
  width: 100%;
}

.stats-container > div { 
  text-align: center; 
}

.stat-box {
  padding: 0.8rem;
  width: 110px;
  border-radius: 14px;
  font-size: 0.8rem; /* Smaller stat font */
  flex-grow: 0;
  flex-shrink: 0;
  max-width: 110px;
  min-height: 70px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #F8FAFC, #E5E7EB);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
  transition: transform 0.2s;
  text-align: center;
}

.stat-box:hover { 
  transform: translateY(-5px); 
}

.stat-box .title {
  font-weight: 500;
  margin-bottom: 0.4rem;
  color: var(--text-color);
  font-size: 0.8rem; /* Smaller title */
  white-space: normal;
  line-height: 1.2;
}

.stat-box .amount {
  font-weight: 700;
  font-size: 1.1rem; /* Smaller amount */
  display: flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}

.stat-box .amount.no-data {
  font-size: 0.7rem;
  white-space: normal;
  word-wrap: break-word;
  line-height: 1.2;
}

.income .amount { color: #10B981; }
.expense .amount { color: #EF4444; }
.balance .amount { color: var(--primary-color); }

/* Nh√≥m: Tab 1 - Th·ªëng k√™ */
.chart-container {
  margin-top: 0;
  width: 100%;
  max-width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.8rem;
  text-align: center;
}

.chart-container h1 { 
  width: 100%; 
  text-align: center; 
  margin: 0 auto; 
  font-size: 1.8rem; /* Smaller chart title */
}

canvas#myChart {
  width: 100% !important;
  height: auto !important;
  max-width: 500px !important;
  aspect-ratio: 1 / 1;
  display: block;
  margin: 0 auto;
  background: var(--card-bg);
  border-radius: 14px;
  padding: 8px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.custom-legend {
  width: 100%;
  max-width: 600px;
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem; /* Smaller legend font */
  padding: 0;
  margin: 1.8rem auto 0;
  gap: 0.2rem;
}

.custom-legend-column {
  width: 48%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-width: 260px;
}

.legend-item {
  display: flex;
  align-items: flex-start;
  margin-bottom: 0.7rem;
}

.legend-color {
  width: 14px; height: 14px;
  margin-right: 0.6rem;
  display: inline-block;
  flex-shrink: 0;
  border-radius: 4px;
  margin-top: 2px;
}

.legend-text { 
  font-size: 0.9rem; 
  display: flex;
  flex-direction: column;
}

.legend-value { 
  font-weight: 700; 
  margin-top: 0.2rem;
}

/* Nh√≥m: Tab 2 - Bi·ªÉu ƒë·ªì */
canvas#monthlyChart {
  width: 100% !important;
  height: auto !important;
  max-width: 500px !important;
  min-height: 320px; 
  max-height: 420px;
  display: block;
  margin: 0 auto;
  background: var(--card-bg);
  border-radius: 14px;
  padding: 8px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.monthly-legend {
  width: 100%;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  font-size: 0.9rem; /* Smaller monthly legend font */
  padding: 0 18px;
  margin: 1.8rem auto 0;
  gap: 0.9rem;
  align-items: center;
}

.monthly-column {
  width: 100%;
  max-width: 380px;
  display: flex;
  flex-direction: column;
  gap: 1.3rem;
  text-align: left;
  min-width: 0;
}

.month-item { 
  text-align: left; 
  white-space: nowrap;
}

.month-item h3 { 
  font-size: 1.1rem; /* Smaller month title */
  margin-bottom: 0.4rem; 
  font-weight: 500; 
  white-space: nowrap; 
}

.month-item p {
  margin: 0.4rem 0;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  white-space: nowrap;
}

.month-item .color-box {
  width: 14px; height: 14px;
  margin-right: 0.6rem;
  display: inline-block;
  border-radius: 4px;
  flex-shrink: 0;
}

.month-item .amount { 
  font-weight: 700; 
  margin-left: 0.4rem; 
}

.month-item .difference { 
  font-weight: 700; 
  margin-left: 0.4rem; 
}

.month-item .difference-icon { 
  margin-right: 0.4rem; 
  font-size: 0.7rem; 
}

.difference.positive { color: #10B981; }
.difference.negative { color: #EF4444; }
.difference-icon.positive { color: #10B981; }
.difference-icon.negative { color: #EF4444; }

/* Nh√≥m: Tab 3 - Gi·ªõi thi·ªáu */
.info-section {
  width: 100%;
  max-width: 480px;
  margin: 0 auto;
  padding: 0 18px;
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}
.info-card h1 {
  text-align: left;
  font-size: 1.4rem; /* Smaller info card title */
}
.info-card {
  background: var(--card-bg);
  border-radius: 14px;
  padding: 1.3rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.info-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.info-card h1 {
  font-weight: 600;
  margin-bottom: 0.9rem;
  color: var(--text-color);
  border-left: 4px solid var(--primary-color);
  padding-left: 0.6rem;
}

.info-card p {
  margin: 0.6rem 0;
  font-size: 0.9rem; /* Smaller info card text */
  line-height: 1.5;
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-color);
}

.info-card p strong {
  font-weight: 500;
  color: var(--text-color);
}

.info-card a {
  color: var(--primary-color);
  text-decoration: none;
  transition: color 0.3s ease;
}

.info-card a:hover {
  color: var(--accent-color);
  text-decoration: underline;
}

.custom-text {
  text-align: justify;
  font-style: italic;
  font-size: 0.9rem;
  color: var(--secondary-color);
  line-height: 1.5;
}

.qr-container {
  text-align: center;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.4rem;
}

.qr-frame {
  display: inline-block;
  padding: 0.8rem;
  background: var(--card-bg);
  border-radius: 14px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.qr-frame:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.qr-image {
  max-width: 100%;
  width: 380px;
  height: auto;
  border-radius: 10px;
}

.qr-caption {
  margin-top: 0.4rem;
  font-size: 0.9rem;
  color: var(--secondary-color);
  font-style: italic;
}

.cta-button {
  display: inline-block;
  margin-top: 0;
  padding: 0.6rem 1.3rem;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  color: white;
  border-radius: 10px;
  text-decoration: none;
  font-weight: 500;
  font-size: 0.9rem; /* Smaller button font */
  transition: transform 0.3s ease, background 0.3s ease;
}

.cta-button:hover {
  transform: translateY(-3px);
  background: linear-gradient(135deg, var(--gradient-end), var(--gradient-start));
}

.contact-columns {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  width: 100%;
}

.highlight-color {
  color: var(--primary-color);
}

/* Nh√≥m: Tab 4 - Giao d·ªãch */
.transactions-list {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.9rem;
  width: 100%;
  margin-bottom: 1.8rem;
}

.transaction-box {
  padding: 0.8rem;
  width: 100%;
  max-width: 580px;
  border-radius: 14px;
  font-size: 0.9rem; /* Smaller transaction font */
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  background: linear-gradient(135deg, #F8FAFC, #E5E7EB);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
  transition: transform 0.2s;
  margin-bottom: 0.9rem;
  margin-left: auto;
  margin-right: auto;
}

.transaction-box:hover { 
  transform: translateY(-5px); 
}

.transaction-box .date {
  font-weight: 500;
  font-size: 1rem;
  color: var(--text-color);
  margin-bottom: 0.4rem;
}

.transaction-box .amount {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 0.4rem;
}

.transaction-box .type {
  font-size: 0.9rem;
  margin-bottom: 0.4rem;
  font-weight: 700;
}

.transaction-box .category {
  font-size: 0.9rem;
  font-style: italic;
  color: var(--secondary-color);
}

.transaction-box .type.expense { color: #EF4444; }
.transaction-box .type.income { color: #10B981; }
.transaction-box .content {
  font-size: 0.9rem;
  margin-bottom: 0.4rem;
  white-space: normal;
  word-wrap: break-word;
}

.transaction-box .amount {
  font-size: 0.9rem;
}

/* Nh√≥m: Media Queries - Responsive Design */
@media (max-width: 600px) {
  body { 
    padding: 100px 5px 10px; 
    font-size: 0.85rem; 
  }
  .header {
    padding: 6px 10px;
    height: 40px; /* TƒÉng chi·ªÅu cao t·ª´ 36px l√™n 40px ƒë·ªÉ t·∫°o kho·∫£ng c√°ch v·ªõi thanh ƒëi·ªÅu h∆∞·ªõng */
  }
  .header .version, .header .author {
    font-size: 0.9rem;
  }
  .top-nav {
    top: 40px; /* ƒê·∫©y xu·ªëng t∆∞∆°ng ·ª©ng v·ªõi chi·ªÅu cao header m·ªõi */
    height: 50px;
    padding: 10px 0;
  }
  .nav-item i { font-size: 1.1rem; }
  .nav-item span { font-size: 0.7rem; }
}
  .stat-box { 
    width: 90px; 
    max-width: 90px; 
    padding: 0.7rem; 
    min-height: 60px; 
    font-size: 0.7rem; 
  }
  .stat-box .title { font-size: 0.7rem; margin-bottom: 0.4rem; }
  .stat-box .amount { font-size: 0.9rem; }
  .chart-container {
    padding: 0 5px;
  }
  canvas#myChart { max-width: 300px !important; }
  canvas#monthlyChart { 
    max-width: 280px !important;
    width: 100% !important;
    min-height: 230px;
    max-height: 320px;
    padding: 5px;
  }
  .custom-legend { 
    flex-direction: column; 
    max-width: 300px; 
    font-size: 0.8rem; 
    gap: 0.3rem; 
  }
  .custom-legend-column { 
    width: 100%; 
    min-width: 0; 
  }
  .legend-text { font-size: 0.8rem; }
  .monthly-legend { 
    max-width: 280px;
    padding: 0 10px; 
    font-size: 0.8rem; 
    gap: 0.3rem; 
  }
  .monthly-column { 
    max-width: 260px;
    gap: 0.9rem; 
  }
  .month-item h3 { font-size: 0.9rem; }
  .month-item p { font-size: 0.8rem; }
  .info-section { padding: 0 10px; gap: 0.3rem; max-width: 380px; }
  .info-card { padding: 0.7rem; }
  .info-card h1 { font-size: 1.1rem; margin-bottom: 0.7rem; }
  .info-card p, .custom-text { font-size: 0.8rem; line-height: 1.3; }
  .qr-image { width: 230px; }
  .qr-caption { font-size: 0.7rem; }
  .cta-button { padding: 0.4rem 0.9rem; font-size: 0.8rem; }
  .transaction-box { padding: 0.7rem; max-width: 300px; margin-bottom: 0.7rem; }
  .transaction-box .date { font-size: 0.9rem; }
  .transaction-box .amount { font-size: 1.1rem; }
  .transaction-box .type { font-size: 0.8rem; }
  .transaction-box .category { font-size: 0.8rem; }
  .transaction-box .content { font-size: 0.8rem; }
}

@media (min-width: 601px) and (max-width: 1023px) {
  body { padding: 110px 18px 18px; }
  h1 { font-size: 1.6rem; }
  .top-nav {
    top: 42px; /* ƒê·∫£m b·∫£o kho·∫£ng c√°ch v·ªõi header */
    height: 55px;
  }
  .stats-container { 
    gap: 1.3rem; 
    justify-content: center;
  }
  .stat-box { width: 120px; padding: 0.9rem; max-width: 120px; }
  .stat-box .title { font-size: 0.9rem; }
  .stat-box .amount { font-size: 1.1rem; }
  canvas#myChart { max-width: 430px !important; }
  canvas#monthlyChart { 
    max-width: 430px !important;
    width: 100% !important;
    min-height: 280px; 
    max-height: 380px;
  }
  .custom-legend { max-width: 530px; font-size: 0.9rem; gap: 0.2rem; }
  .custom-legend-column { width: 48%; min-width: 240px; }
  .legend-text { font-size: 0.9rem; }
  .monthly-legend { 
    max-width: 430px;
    font-size: 0.9rem; 
    gap: 0.4rem;
  }
  .monthly-column { 
    max-width: 380px; 
  }
  .month-item h3 { font-size: 1rem; }
  .month-item p { font-size: 0.9rem; }
  select, input[type="date"] { width: 140px; font-size: 0.9rem; }
  button { padding: 0.7rem 1.3rem; font-size: 0.9rem; }
  .top-nav { height: 55px; }
  .nav-item i { font-size: 1.3rem; }
  .nav-item span { font-size: 0.8rem; }
  .info-card h1 { font-size: 1.3rem; }
  .info-card p, .custom-text { font-size: 0.9rem; }
  .qr-image { width: 330px; }
  .qr-caption { margin-top: 0.4rem; }
  .cta-button { padding: 0.6rem 1.2rem; font-size: 0.9rem; margin-top: 0; }
}

@media (min-width: 1024px) {
  .content-wrapper { max-width: 780px; }
  body { padding: 120px 28px 28px; }
  .top-nav {
    top: 42px; /* ƒê·∫£m b·∫£o kho·∫£ng c√°ch v·ªõi header */
  }
  h1 { font-size: 1.8rem; }
  .stats-container { 
    gap: 1.8rem; 
    justify-content: center;
  }
  .stat-box { width: 130px; padding: 0.9rem; max-width: 130px; }
  .stat-box .title { font-size: 0.9rem; }
  .stat-box .amount { font-size: 1.2rem; }
  canvas#myChart { max-width: 480px !important; }
  canvas#monthlyChart { 
    max-width: 480px !important;
    width: 100% !important;
    min-height: 320px; 
    max-height: 420px; 
  }
  .custom-legend { max-width: 580px; font-size: 0.9rem; gap: 0.2rem; }
  .custom-legend-column { width: 48%; min-width: 260px; }
  .legend-text { font-size: 0.9rem; }
  .monthly-legend { 
    max-width: 480px;
    font-size: 0.9rem; 
    gap: 0.4rem;
  }
  .monthly-column { 
    max-width: 430px; 
  }
  .month-item h3 { font-size: 1.1rem; }
  .month-item p { font-size: 0.9rem; }
  .info-card h1 { font-size: 1.4rem; }
  .info-card p, .custom-text { font-size: 0.9rem; }
  .qr-image { width: 380px; }
  .qr-caption { margin-top: 0.4rem; }
  .cta-button { padding: 0.7rem 1.3rem; font-size: 0.9rem; margin-top: 0; }
}

/* Popup Notification */
.popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 4000;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}

.popup.show {
  display: flex;
  opacity: 1;
}

.popup-content {
  background: #FFFFFF;
  padding: 1.3rem;
  border-radius: 14px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  max-width: 90%;
  width: 380px;
  position: relative;
  text-align: left;
}

.popup-content h2 {
  font-size: 1.4rem;
  margin-bottom: 0.9rem;
  color: var(--text-color);
}

.popup-content p {
  font-size: 0.9rem;
  margin-bottom: 0.4rem;
  color: var(--text-color);
  line-height: 1.4;
}

.popup-content ul {
  list-style-type: disc;
  padding-left: 1.3rem;
  margin-bottom: 0.4rem;
}

.popup-content ul li {
  font-size: 0.9rem;
  margin-bottom: 0.4rem;
  color: var(--text-color);
}

.popup-content .note {
  font-style: italic;
  color: var(--secondary-color);
  font-size: 0.8rem;
  margin-bottom: 0.9rem;
}

.popup-content .close-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: none;
  border: none;
  font-size: 1.3rem;
  cursor: pointer;
  color: var(--secondary-color);
}

.popup-content .checkbox-container {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-top: 0.9rem;
}

.popup-content input[type="checkbox"] {
  width: 14px;
  height: 14px;
}

.popup-content label {
  font-size: 0.8rem;
  color: var(--text-color);
}

@media (max-width: 600px) {
  .popup-content {
    width: 90%;
    padding: 0.9rem;
  }

  .popup-content h2 {
    font-size: 1.1rem;
  }

  .popup-content p,
  .popup-content ul li {
    font-size: 0.8rem;
  }

  .popup-content .note {
    font-size: 0.7rem;
  }

  .popup-content .close-btn {
    font-size: 1.1rem;
  }
}
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background-color: var(--card-bg);
  padding: 6px 20px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  z-index: 999;
  height: 42px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header .version {
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-color);
  text-align: left;
}

.header .author {
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-color);
  text-align: right;
}


/* ƒêi·ªÅu ch·ªânh cho m√†n h√¨nh nh·ªè h∆°n */
@media (max-width: 600px) {
  .header {
    padding: 12px 10px 10px;
    height: 37px;
  }
  .header .version, .header .author {
    font-size: 0.9rem;
  }
}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>
<body>
  <div class="header">
    <span class="version">Phi√™n b·∫£n mi·ªÖn ph√≠</span>
    <span class="author">masterhmh</span>
  </div>

  <div id="notificationPopup" class="popup">
    <div class="popup-content">
      <button class="close-btn" onclick="closePopup()">√ó</button>
      <h2>Th√¥ng b√°o</h2>
      <p><strong>C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng Miniapp!</strong></p>
      <p>Ch√∫ng t√¥i m·ªõi c·∫≠p nh·∫≠t th√™m giao di·ªán Dark Mode (Ch·∫ø ƒë·ªô t·ªëi) cho Miniapp. B·∫°n h√£y chuy·ªÉn giao di·ªán c·ªßa thi·∫øt b·ªã sang ch·∫ø ƒë·ªô Dark Mode (Ch·∫ø ƒë·ªô t·ªëi) ƒë·ªÉ tr·∫£i nghi·ªám nh√©</p>
      <p>Ch√∫ng t√¥i r·∫•t tr√¢n tr·ªçng s·ª± ƒë·ªìng h√†nh c·ªßa b·∫°n. Tuy nhi√™n, sau th·ªùi gian ph√°t tri·ªÉn, ch√∫ng t√¥i nh·∫≠n th·∫•y b·∫£n mi·ªÖn ph√≠ c√≤n nhi·ªÅu gi·ªõi h·∫°n.</p>
      <p>V√¨ th·∫ø, t·ª´ ng√†y <strong>30/04/2025</strong>, Miniapp s·∫Ω ra m·∫Øt <strong>phi√™n b·∫£n PRO</strong> v·ªõi gi√° ch·ªâ <strong>49.000ƒë</strong>, bao g·ªìm c√°c t√≠nh nƒÉng n√¢ng c·∫•p:</p>
      <ul>
        <li>Th√™m/s·ª≠a/xo√° giao d·ªãch</li>
        <li>Th√™m/xo√° t·ª´ kho√°</li>
        <li>T√¨m ki·∫øm & l·ªçc giao d·ªãch theo th√°ng</li>
        <li>TƒÉng t·ªëc x·ª≠ l√Ω d·ªØ li·ªáu</li>
      </ul>
      <p><strong>üìå L∆∞u √Ω:</strong></p>
      <ul>
        <li>B·∫£n mi·ªÖn ph√≠ s·∫Ω duy tr√¨ ƒë·∫øn <strong>31/05/2025</strong></li>
        <li>Sau ng√†y <strong>31/05/2025</strong>n·∫øu b·∫°n v·∫´n mu·ªën s·ª≠ d·ª•ng phi√™n b·∫£n mi·ªÖn ph√≠ n√†y th√¨ h√£y li√™n h·ªá v·ªõi ch√∫ng t√¥i ƒë·ªÉ nh·∫≠n code k√≠ch ho·∫°t v·ªõi gi√° <strong>19.000ƒë</strong> </li>
        <li>B·∫£n PRO kh√¥ng t∆∞∆°ng th√≠ch v·ªõi ƒëo·∫°n m√£ Google Apps Script c≈©</li>
        <li>N·∫øu b·∫°n mu·ªën n√¢ng c·∫•p, h√£y li√™n h·ªá v·ªõi ch√∫ng t√¥i ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.</li>
      </ul>
      <div class="checkbox-container">
        <input type="checkbox" id="dontShowAgain">
        <label for="dontShowAgain">Kh√¥ng hi·ªÉn th·ªã l·∫°i</label>
      </div>
    </div>
  </div>

  <div class="top-nav">
    <div class="nav-item active" data-tab="tab4">
      <i class="fas fa-list"></i>
      <span>Giao d·ªãch</span>
    </div>
    <div class="nav-item" data-tab="tab1">
      <i class="fas fa-table"></i>
      <span>Th·ªëng k√™</span>
    </div>
    <div class="nav-item" data-tab="tab2">
      <i class="fas fa-chart-bar"></i>
      <span>Bi·ªÉu ƒë·ªì</span>
    </div>
    <div class="nav-item" data-tab="tab3">
      <i class="fas fa-info-circle"></i>
      <span>Gi·ªõi thi·ªáu</span>
    </div>
  </div>

  <div class="content-wrapper">
    <div id="tab1" class="tab-content">
      <h1>TH·ªêNG K√ä</h1>
      <p class="notification">Vui l√≤ng ch·ªçn kho·∫£ng th·ªùi gian v√† ·∫•n "L·ªçc" ƒë·ªÉ xem d·ªØ li·ªáu.</p>
      <div class="input-group">
        T·ª´: <input type="date" id="startDate"> 
        ƒê·∫øn: <input type="date" id="endDate"> 
        <button id="fetchDataBtn">L·ªçc</button>
      </div>
      <div class="stats-container" id="statsContainer">
        <div class="stat-box income">
          <div class="title">T·ªïng thu nh·∫≠p</div>
          <div class="amount">0ƒë</div>
        </div>
        <div class="stat-box expense">
          <div class="title">T·ªïng chi ti√™u</div>
          <div class="amount">0ƒë</div>
        </div>
        <div class="stat-box balance">
          <div class="title">S·ªë d∆∞</div>
          <div class="amount">0ƒë</div>
        </div>
      </div>
      <div class="chart-container">
        <h1>BI·ªÇU ƒê·ªí CHI TI√äU</h1>
        <canvas id="myChart"></canvas>
      </div>
      <div class="custom-legend" id="customLegend"></div>
    </div>

    <div id="tab2" class="tab-content">
      <h1>BI·ªÇU ƒê·ªí THU CHI THEO TH√ÅNG</h1>
      <p class="notification">Vui l√≤ng ch·ªçn kho·∫£ng th·ªùi gian v√† ·∫•n "L·ªçc" ƒë·ªÉ xem d·ªØ li·ªáu.</p>
      <div class="input-group">
        T·ª´: 
        <select id="startMonth">
          <option value="1">Th√°ng 1</option>
          <option value="2">Th√°ng 2</option>
          <option value="3">Th√°ng 3</option>
          <option value="4">Th√°ng 4</option>
          <option value="5">Th√°ng 5</option>
          <option value="6">Th√°ng 6</option>
          <option value="7">Th√°ng 7</option>
          <option value="8">Th√°ng 8</option>
          <option value="9">Th√°ng 9</option>
          <option value="10">Th√°ng 10</option>
          <option value="11">Th√°ng 11</option>
          <option value="12">Th√°ng 12</option>
        </select>
        ƒê·∫øn: 
        <select id="endMonth">
          <option value="1">Th√°ng 1</option>
          <option value="2">Th√°ng 2</option>
          <option value="3">Th√°ng 3</option>
          <option value="4">Th√°ng 4</option>
          <option value="5">Th√°ng 5</option>
          <option value="6">Th√°ng 6</option>
          <option value="7">Th√°ng 7</option>
          <option value="8">Th√°ng 8</option>
          <option value="9">Th√°ng 9</option>
          <option value="10">Th√°ng 10</option>
          <option value="11">Th√°ng 11</option>
          <option value="12">Th√°ng 12</option>
        </select>
        <button id="fetchMonthlyDataBtn">L·ªçc</button>
      </div>
      <div class="chart-container">
        <canvas id="monthlyChart"></canvas>
        <div class="monthly-legend" id="monthlyLegend"></div>
      </div>
    </div>

    <div id="tab3" class="tab-content">
      <h1>GI·ªöI THI·ªÜU</h1>
      <div class="info-section">
        <div class="info-card">
          <h1>V·ªÅ MiniApp</h1>
          <p class="custom-text">
            Miniapp t√†i ch√≠nh tr√™n Telegram gi√∫p b·∫°n theo d√µi thu nh·∫≠p v√† chi ti√™u d·ªÖ d√†ng. D·ª±a v√†o d·ªØ li·ªáu trong Google Sheet n√≥ s·∫Ω hi·ªÉn th·ªã danh s√°ch giao d·ªãch trong ng√†y, bi·ªÉu ƒë·ªì chi ti√™u theo ph√¢n lo·∫°i chi ti·∫øt v√† bi·ªÉu ƒë·ªì thu nh·∫≠p ‚Äì chi ti√™u h√†ng th√°ng ngay trong Telegram. 
          </p>
        </div>
        <div class="info-card">
          <h1>·ª¶ng h·ªô</h1>
          <p class="custom-text">
            N·∫øu b·∫°n th·∫•y n√≥ h·ªØu √≠ch, h√£y ·ªßng h·ªô m√¨nh m·ªôt ly c√† ph√™ ƒë·ªÉ c√≥ th√™m ƒë·ªông l·ª±c duy tr√¨ v√† ph√°t tri·ªÉn nh√©!
          </p>
          <p><i class="fas fa-university" style="color: var(--accent-color);"></i><strong>Ng√¢n h√†ng:</strong> TMCP S√†i G√≤n ‚Äì H√† N·ªôi (SHB)</p>
          <p><i class="fas fa-user" style="color: var(--accent-color);"></i><strong>Ch·ªß t√†i kho·∫£n:</strong> Hoang Manh Hung</p>
          <p><i class="fas fa-credit-card" style="color: var(--accent-color);"></i><strong>S·ªë t√†i kho·∫£n:</strong> 6666.6789.9999</p>
        </div>
        <div class="qr-container">
          <a href="https://momo.vn/" target="_blank" class="cta-button">·ª¶ng h·ªô ngay</a>
          <div class="qr-frame">
            <img id="qrImage" src="https://i.pinimg.com/736x/7c/13/53/7c135389e26cbc6460626deb9e2aa5c6.jpg" alt="QR Code" class="qr-image">
          </div>
          <p class="qr-caption">Qu√©t m√£ QR ƒë·ªÉ ·ªßng h·ªô qua Momo</p>
        </div>
        <div class="info-card">
          <h1>Li√™n h·ªá</h1>
          <div class="contact-columns">
            <div class="contact-column">
              <p><i class="fab fa-telegram-plane" style="color: var(--primary-color);"></i><strong>Telegram:</strong> <a href="https://t.me/masterhmh" target="_blank">@masterhmh</a></p>
              <p><i class="fab fa-facebook" style="color: var(--primary-color);"></i><strong>Facebook:</strong> <a href="https://facebook.com/masterhmh" target="_blank">facebook.com/masterhmh</a></p>
             </div>
          </div>
        </div>
      </div>
    </div>

    <div id="tab4" class="tab-content active">
      <h1>GIAO D·ªäCH TRONG NG√ÄY</h1>
      <p class="notification">Vui l√≤ng ch·ªçn ng√†y v√† ·∫•n "L·ªçc" ƒë·ªÉ xem d·ªØ li·ªáu.</p>
      <div class="input-group">
        Ng√†y: <input type="date" id="transactionDate">
        <button id="fetchTransactionsBtn">L·ªçc</button>
      </div>
      <div class="stats-container" id="dailySummary">
        <div class="stat-box income">
          <div class="title">T·ªïng thu nh·∫≠p</div>
          <div class="amount">0ƒë</div>
        </div>
        <div class="stat-box expense">
          <div class="title">T·ªïng chi ti√™u</div>
          <div class="amount">0ƒë</div>
        </div>
        <div class="stat-box balance">
          <div class="title">S·ªë d∆∞</div>
          <div class="amount">0ƒë</div>
        </div>
      </div>
      <div class="transactions-list" id="transactionsContainer">
        <!-- Giao d·ªãch s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
      </div>
    </div>
  </div>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const apiUrl = urlParams.get('api');
    const sheetId = urlParams.get('sheetId');

    if (!apiUrl || !sheetId) {
      alert("Thi·∫øu th√¥ng tin API ho·∫∑c Sheet ID. Vui l√≤ng ki·ªÉm tra l·∫°i URL!");
    }

    window.openTab = function(tabId) {
      console.log("Opening tab: " + tabId);
      const tabs = document.querySelectorAll('.nav-item');
      const contents = document.querySelectorAll('.tab-content');
      tabs.forEach(tab => tab.classList.remove('active'));
      contents.forEach(content => content.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
    };

    window.fetchData = async function() {
      const startDateInput = document.getElementById('startDate').value;
      const endDateInput = document.getElementById('endDate').value;
      console.log("Fetching data from: " + startDateInput + " to: " + endDateInput);
      if (!startDateInput || !endDateInput) {
        alert("Vui l√≤ng ch·ªçn kho·∫£ng th·ªùi gian!");
        return;
      }
      const startDate = new Date(startDateInput);
      const endDate = new Date(endDateInput);
      if (startDate > endDate) {
        alert("Ng√†y b·∫Øt ƒë·∫ßu kh√¥ng th·ªÉ l·ªõn h∆°n ng√†y k·∫øt th√∫c!");
        return;
      }

      try {
        const financialResponse = await fetch(`${apiUrl}?action=getFinancialSummary&startDate=${startDateInput}&endDate=${endDateInput}&sheetId=${sheetId}`);
        const financialData = await financialResponse.json();
        console.log("Financial data received: ", financialData);
        if (financialData.error) {
          throw new Error(financialData.error);
        }
        updateFinancialData(financialData);

        const chartResponse = await fetch(`${apiUrl}?action=getChartData&startDate=${startDateInput}&endDate=${endDateInput}&sheetId=${sheetId}`);
        const chartData = await chartResponse.json();
        console.log("Chart data received: ", chartData);
        if (chartData.error) {
          throw new Error(chartData.error);
        }
        updateChartData(chartData);
      } catch (error) {
        console.error("Error fetching data: ", error);
        alert("L·ªói khi l·∫•y d·ªØ li·ªáu: " + error.message);
        updateFinancialData({ error: true });
      }
    };

    function updateFinancialData(data) {
      console.log("Updating financial data with: ", data);
      const container = document.getElementById('statsContainer');

      if (!data || data.error) {
        console.log("No data or error detected");
        container.innerHTML = `
          <div class="stat-box income">
            <div class="title">T·ªïng thu nh·∫≠p</div>
            <div class="amount">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
          <div class="stat-box expense">
            <div class="title">T·ªïng chi ti√™u</div>
            <div class="amount">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
          <div class="stat-box balance">
            <div class="title">S·ªë d∆∞</div>
            <div class="amount">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
        `;
        return;
      }

      const totalIncome = Number(data.income) || 0;
      const totalExpense = Number(data.expense) || 0;

      if (totalIncome === 0 && totalExpense === 0) {
        container.innerHTML = `
          <div class="stat-box income">
            <div class="title">T·ªïng thu nh·∫≠p</div>
            <div class="amount">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
          <div class="stat-box expense">
            <div class="title">T·ªïng chi ti√™u</div>
            <div class="amount">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
          <div class="stat-box balance">
            <div class="title">S·ªë d∆∞</div>
            <div class="amount">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
        `;
        return;
      }

      const balance = totalIncome - totalExpense;

      container.innerHTML = `
        <div class="stat-box income">
          <div class="title">T·ªïng thu nh·∫≠p</div>
          <div class="amount">${totalIncome.toLocaleString('vi-VN')}ƒë</div>
        </div>
        <div class="stat-box expense">
          <div class="title">T·ªïng chi ti√™u</div>
          <div class="amount">${totalExpense.toLocaleString('vi-VN')}ƒë</div>
        </div>
        <div class="stat-box balance">
          <div class="title">S·ªë d∆∞</div>
          <div class="amount">${balance.toLocaleString('vi-VN')}ƒë</div>
        </div>
      `;
    }

    function updateChartData(response) {
      if (response.error) {
        alert(response.error);
        if (window.myChart && typeof window.myChart.destroy === 'function') {
          window.myChart.destroy();
        }
        return;
      }
      const chartData = response.chartData;
      const categories = response.categories;
      const ctx = document.getElementById('myChart').getContext('2d');
      if (window.myChart && typeof window.myChart.destroy === 'function') {
        window.myChart.destroy();
      }
      const totalAmount = chartData.reduce((sum, item) => sum + item.amount, 0);
      const backgroundColors = [
        '#3B82F6', '#60A5FA', '#93C5FD', '#A5B4FC', '#C4B5FD',
        '#D8B4FE', '#F0ABFC', '#FCA5A5', '#FECACA', '#FEE2E2',
        '#6EE7B7', '#34D399', '#A7F3D0', '#5EEAD4', '#99F6E4',
        '#FBBF24', '#FCD34D', '#FDE68A', '#FEF3C7', '#D97706',
        '#F59E0B', '#FCD34D', '#FACC15', '#EAB308', '#CA8A04',
        '#6B7280', '#9CA3AF', '#D1D5DB', '#E5E7EB', '#F3F4F6',
        '#374151', '#4B5563', '#6B7280', '#9CA3AF', '#D1D5DB'
      ];
      const customLegend = document.getElementById('customLegend');
      customLegend.innerHTML = '';
      const leftColumn = document.createElement('div');
      leftColumn.className = 'custom-legend-column';
      const rightColumn = document.createElement('div');
      rightColumn.className = 'custom-legend-column';
      chartData.forEach((item, i) => {
        const index = categories.indexOf(item.category);
        const color = backgroundColors[index % backgroundColors.length];
        const percentage = ((item.amount / totalAmount) * 100).toFixed(1);
        const legendItem = document.createElement('div');
        legendItem.className = 'legend-item';
        legendItem.innerHTML = `
          <span class="legend-color" style="background-color: ${color};"></span>
          <span class="legend-text">
            ${item.category}:
            <span class="legend-value">${item.amount.toLocaleString('vi-VN')}ƒë (${percentage}%)</span>
          </span>
        `;
        if (i % 2 === 0) {
          leftColumn.appendChild(legendItem);
        } else {
          rightColumn.appendChild(legendItem);
        }
      });
      customLegend.appendChild(leftColumn);
      customLegend.appendChild(rightColumn);
      window.myChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: chartData.map(item => item.category),
          datasets: [{
            data: chartData.map(item => item.amount),
            backgroundColor: chartData.map(item => {
              const index = categories.indexOf(item.category);
              return backgroundColors[index % backgroundColors.length];
            })
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          aspectRatio: 1,
          plugins: {
            legend: { display: false },
            tooltip: {
              mode: 'index',
              intersect: false,
              callbacks: {
                label: function(tooltipItem) {
                  const category = tooltipItem.label;
                  const amount = tooltipItem.raw;
                  const percentage = ((amount / totalAmount) * 100).toFixed(1);
                  return `${category}: ${amount.toLocaleString('vi-VN')}ƒë (${percentage}%)`;
                }
              },
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleFont: { size: 11 },
              bodyFont: { size: 9 },
              titleColor: '#fff',
              bodyColor: '#fff',
              padding: 7,
              displayColors: true,
            },
            datalabels: {
              formatter: (value, context) => {
                const percentage = ((value / totalAmount) * 100).toFixed(1);
                return percentage >= 1 ? `${value.toLocaleString('vi-VN')}ƒë (${percentage}%)` : '';
              },
              color: '#fff',
              font: { weight: 'bold', size: 11 },
              anchor: 'end',
              align: 'end',
              clamp: true
            }
          }
        }
      });
    }

    window.fetchMonthlyData = async function() {
      const startMonth = parseInt(document.getElementById('startMonth').value);
      const endMonth = parseInt(document.getElementById('endMonth').value);
      const year = new Date().getFullYear();
      console.log("Fetching monthly data from month: " + startMonth + " to: " + endMonth);
      if (startMonth > endMonth) {
        alert("Th√°ng b·∫Øt ƒë·∫ßu kh√¥ng th·ªÉ l·ªõn h∆°n th√°ng k·∫øt th√∫c!");
        return;
      }

      try {
        const response = await fetch(`${apiUrl}?action=getMonthlyData&year=${year}&sheetId=${sheetId}`);
        const monthlyData = await response.json();
        console.log("Monthly data received: ", monthlyData);
        if (monthlyData.error) {
          throw new Error(monthlyData.error);
        }

        const fullYearData = Array.from({ length: 12 }, (_, i) => {
          const month = i + 1;
          const existingData = monthlyData.find(item => item.month === month);
          return existingData || { month, income: 0, expense: 0 };
        });

        const filteredData = Array.from({ length: endMonth - startMonth + 1 }, (_, i) => {
          const month = startMonth + i;
          const existingData = fullYearData.find(item => item.month === month);
          return existingData || { month, income: 0, expense: 0 };
        });

        updateMonthlyChart(filteredData);
      } catch (error) {
        console.error("Error fetching monthly data: ", error);
        alert("L·ªói khi l·∫•y d·ªØ li·ªáu bi·ªÉu ƒë·ªì th√°ng: " + error.message);
        const filteredData = Array.from({ length: endMonth - startMonth + 1 }, (_, i) => ({
          month: startMonth + i,
          income: 0,
          expense: 0
        }));
        updateMonthlyChart(filteredData);
      }
    };

    function updateMonthlyChart(filteredData) {
      console.log("Updating monthly chart with data: ", filteredData);
      const ctx = document.getElementById('monthlyChart').getContext('2d');
      if (window.monthlyChart && typeof window.monthlyChart.destroy === 'function') {
        window.monthlyChart.destroy();
      }

      if (!filteredData || filteredData.length === 0) {
        window.monthlyChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Kh√¥ng c√≥ d·ªØ li·ªáu'],
            datasets: [
              { label: 'Thu nh·∫≠p', data: [0], backgroundColor: '#10B981' },
              { label: 'Chi ti√™u', data: [0], backgroundColor: '#EF4444' }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1,
            scales: {
              y: { 
                beginAtZero: true, 
                title: { display: true, text: 'S·ªë ti·ªÅn (ƒë)', font: { size: 13 } }, 
                ticks: { font: { size: 11 } } 
              },
              x: { 
                title: { display: true, text: 'Th√°ng', font: { size: 13 } }, 
                ticks: { font: { size: 11 } } 
              }
            },
            plugins: {
              legend: { display: true, labels: { font: { size: 11 } } },
              tooltip: {
                titleFont: { size: 11 },
                bodyFont: { size: 11 },
                callbacks: {
                  label: function(tooltipItem) {
                    return `${tooltipItem.dataset.label}: ${tooltipItem.raw.toLocaleString('vi-VN')}ƒë`;
                  }
                }
              },
              datalabels: { display: false }
            }
          }
        });
        document.getElementById('monthlyLegend').innerHTML = '<div>Kh√¥ng c√≥ d·ªØ li·ªáu</div>';
        return;
      }

      const labels = filteredData.map(item => `Th√°ng ${item.month}`);
      const incomes = filteredData.map(item => item.income);
      const expenses = filteredData.map(item => item.expense);

      window.monthlyChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            { label: 'Thu nh·∫≠p', data: incomes, backgroundColor: '#10B981', borderColor: '#10B981', borderWidth: 1 },
            { label: 'Chi ti√™u', data: expenses, backgroundColor: '#EF4444', borderColor: '#EF4444', borderWidth: 1 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          aspectRatio: 1,
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'S·ªë ti·ªÅn (ƒë)', font: { size: 13 } },
              ticks: {
                callback: function(value) { return value.toLocaleString('vi-VN') + 'ƒë'; },
                font: { size: 11 }
              }
            },
            x: {
              title: { display: true, text: 'Th√°ng', font: { size: 13 } },
              ticks: {
                font: { size: 9 },
                maxRotation: 45,
                minRotation: 45,
                autoSkip: false
              }
            }
          },
          plugins: {
            legend: { display: true, labels: { font: { size: 11 } } },
            tooltip: {
              titleFont: { size: 11 },
              bodyFont: { size: 11 },
              callbacks: {
                label: function(tooltipItem) {
                  return `${tooltipItem.dataset.label}: ${tooltipItem.raw.toLocaleString('vi-VN')}ƒë`;
                }
              }
            },
            datalabels: {
              display: true,
              align: 'end',
              anchor: 'end',
              formatter: (value) => value.toLocaleString('vi-VN') + 'ƒë',
              color: '#1F2A44',
              font: { weight: 'bold', size: 11 }
            }
          }
        }
      });

      const monthlyLegend = document.getElementById('monthlyLegend');
      monthlyLegend.innerHTML = '';
      const column = document.createElement('div');
      column.className = 'monthly-column';

      filteredData.forEach(item => {
        const difference = item.income - item.expense;
        const diffClass = difference >= 0 ? 'positive' : 'negative';
        const diffIcon = difference >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
        const monthItem = document.createElement('div');
        monthItem.className = 'month-item';
        monthItem.innerHTML = `
          <h3>Th√°ng ${item.month}:</h3>
          <p><span class="color-box" style="background-color: #10B981;"></span>T·ªïng thu nh·∫≠p: <strong>${item.income.toLocaleString('vi-VN')}ƒë</strong></p>
          <p><span class="color-box" style="background-color: #EF4444;"></span>T·ªïng chi ti√™u: <strong>${item.expense.toLocaleString('vi-VN')}ƒë</strong></p>
          <p><i class="fas ${diffIcon} difference-icon ${diffClass}"></i>Ch√™nh l·ªách: <span class="difference ${diffClass}"><strong>${difference.toLocaleString('vi-VN')}ƒë</strong></span></p>
        `;
        column.appendChild(monthItem);
      });

      monthlyLegend.appendChild(column);
    }

    window.fetchTransactions = async function() {
      const transactionDate = document.getElementById('transactionDate').value;
      console.log("Fetching transactions for date: " + transactionDate);
      if (!transactionDate) {
        alert("Vui l√≤ng ch·ªçn ng√†y ƒë·ªÉ xem giao d·ªãch!");
        return;
      }

      try {
        const response = await fetch(`${apiUrl}?action=getTransactionsByDate&date=${transactionDate}&sheetId=${sheetId}`);
        const transactionData = await response.json();
        console.log("Transaction data received: ", transactionData);
        if (transactionData.error) {
          throw new Error(transactionData.error);
        }
        displayTransactions(transactionData);
      } catch (error) {
        console.error("Error fetching transactions: ", error.message);
        alert("L·ªói khi l·∫•y d·ªØ li·ªáu giao d·ªãch: " + error.message);
        displayTransactions({ error: true });
      }
    };
    
    function displayTransactions(data) {
      console.log("D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c: ", data);
      const container = document.getElementById('transactionsContainer');
      const summaryContainer = document.getElementById('dailySummary');
      container.innerHTML = '';
      if (data.error || !data || data.length === 0) {
        console.log("Kh√¥ng c√≥ giao d·ªãch ƒë·ªÉ hi·ªÉn th·ªã");
        container.innerHTML = '<div>Kh√¥ng c√≥ giao d·ªãch trong ng√†y n√†y</div>';
        summaryContainer.innerHTML = `
          <div class="stat-box income">
            <div class="title">T·ªïng thu nh·∫≠p</div>
            <div class="amount no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
          <div class="stat-box expense">
            <div class="title">T·ªïng chi ti√™u</div>
            <div class="amount no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
          <div class="stat-box balance">
            <div class="title">S·ªë d∆∞</div>
            <div class="amount no-data">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
          </div>
        `;
        return;
      }
      let totalIncome = 0;
      let totalExpense = 0;
      data.forEach(item => {
        if (item.type === 'Thu nh·∫≠p') {
          totalIncome += item.amount;
        } else if (item.type === 'Chi ti√™u') {
          totalExpense += item.amount;
        }
      });
      const balance = totalIncome - totalExpense;
      summaryContainer.innerHTML = `
        <div class="stat-box income">
          <div class="title">T·ªïng thu nh·∫≠p</div>
          <div class="amount">${totalIncome.toLocaleString('vi-VN')}ƒë</div>
        </div>
        <div class="stat-box expense">
          <div class="title">T·ªïng chi ti√™u</div>
          <div class="amount">${totalExpense.toLocaleString('vi-VN')}ƒë</div>
        </div>
        <div class="stat-box balance">
          <div class="title">S·ªë d∆∞</div>
          <div class="amount">${balance.toLocaleString('vi-VN')}ƒë</div>
        </div>
      `;
      console.log("Hi·ªÉn th·ªã giao d·ªãch: ", data.slice(0, 10));
      const limitedData = data.slice(0, 10);
      limitedData.forEach(item => {
        const transactionBox = document.createElement('div');
        transactionBox.className = 'transaction-box';
        const amountColor = item.type === 'Thu nh·∫≠p' ? '#10B981' : '#EF4444';
        const typeClass = item.type === 'Thu nh·∫≠p' ? 'income' : 'expense';
        transactionBox.innerHTML = `
          <div style="display: flex; justify-content: space-between; width: 100%;">
            <div style="flex: 1;">
              <div class="date">${item.date}</div>
              <div class="amount" style="color: ${amountColor}">${item.amount.toLocaleString('vi-VN')}ƒë</div>
              <div class="content">N·ªôi dung: ${item.content}${item.note ? ` (${item.note})` : ''}</div>
            </div>
            <div style="flex: 1; text-align: right;">
              <div class="type ${typeClass}">Ph√¢n lo·∫°i: ${item.type}</div>
              <div class="category">Ph√¢n lo·∫°i chi ti·∫øt: ${item.category}</div>
            </div>
          </div>
        `;
        container.appendChild(transactionBox);
      });
    }

    function getCurrentMonthRange() {
      const now = new Date();
      const startDate = new Date(now.getFullYear(), now.getMonth(), 1);
      const endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
      return {
        startDate: formatDateToYYYYMMDD(startDate),
        endDate: formatDateToYYYYMMDD(endDate)
      };
    }

    function formatDateToYYYYMMDD(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log("Document loaded, initializing...");
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          window.openTab(tabId);
        });
      });
      const fetchDataBtn = document.getElementById('fetchDataBtn');
      fetchDataBtn.addEventListener('click', window.fetchData);
      const fetchMonthlyDataBtn = document.getElementById('fetchMonthlyDataBtn');
      fetchMonthlyDataBtn.addEventListener('click', window.fetchMonthlyData);
      const fetchTransactionsBtn = document.getElementById('fetchTransactionsBtn');
      fetchTransactionsBtn.addEventListener('click', window.fetchTransactions);
      const { startDate, endDate } = getCurrentMonthRange();
      document.getElementById('startDate').value = startDate;
      document.getElementById('endDate').value = endDate;
      document.getElementById('startMonth').value = 1;
      document.getElementById('endMonth').value = 12;
      document.getElementById('transactionDate').value = formatDateToYYYYMMDD(new Date());
      window.openTab('tab4');
      const qrImage = document.getElementById('qrImage');
      qrImage.src = 'https://i.pinimg.com/736x/7c/13/53/7c135389e26cbc6460626deb9e2aa5c6.jpg';
      qrImage.onerror = function() {
        qrImage.src = 'https://via.placeholder.com/300';
      };
    });

    function showPopup() {
      const hidePopup = localStorage.getItem('hidePopup');
      const hideTimestamp = localStorage.getItem('hidePopupTimestamp');
      const threeDaysInMs = 3 * 24 * 60 * 60 * 1000;
      const now = new Date().getTime();

      if (hidePopup === 'true' && hideTimestamp) {
        const timeElapsed = now - parseInt(hideTimestamp);
        if (timeElapsed < threeDaysInMs) {
          return;
        } else {
          localStorage.removeItem('hidePopup');
          localStorage.removeItem('hidePopupTimestamp');
        }
      }

      const popup = document.getElementById('notificationPopup');
      setTimeout(() => popup.classList.add('show'), 100);
    }

    function closePopup() {
      const popup = document.getElementById('notificationPopup');
      const dontShowAgain = document.getElementById('dontShowAgain').checked;
      if (dontShowAgain) {
        localStorage.setItem('hidePopup', 'true');
        localStorage.setItem('hidePopupTimestamp', new Date().getTime().toString());
      }
      popup.classList.remove('show');
      setTimeout(() => popup.style.display = 'none', 300);
    }

    document.addEventListener('DOMContentLoaded', function() {
      showPopup();
    });
     </script>
</body>
</html>
